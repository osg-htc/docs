<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Install VOMS - OSG Documentation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  <link href="../../css/extra.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Install VOMS";
    var mkdocs_page_input_path = "other/install-voms.md";
    var mkdocs_page_url = "/other/install-voms/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-69012-29', 'opensciencegrid.github.io');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> OSG Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
  
    <a class="" href="../..">Home</a>
  
	    </li>
          
            <li class="toctree-l1">
		
  
    <a class="" href="../../site-planning/">Site Planning</a>
  
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Compute Element</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../../compute-element/htcondor-ce-overview/">HTCondor-CE Overview</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../compute-element/install-htcondor-ce/">Install HTCondor-CE</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../compute-element/job-router-recipes/">Job Router Recipes</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../compute-element/troubleshoot-htcondor-ce/">Troubleshooting HTCondor-CE</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../compute-element/submit-htcondor-ce/">Submitting to HTCondor-CE</a>
  
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Worker Node</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../../worker-node/using-wn/">Worker Node Overview</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../worker-node/install-wn/">Worker Node via RPM</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../worker-node/install-wn-tarball/">Worker Node via Tarball</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../worker-node/install-wn-oasis/">Worker Node via OASIS</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../worker-node/install-cvmfs/">CVMFS</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../worker-node/install-singularity/">Singularity</a>
  
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Data - HTTP & CVMFS</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../../data/frontier-squid/">Install HTTP Cache</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../data/update-oasis/">Update OASIS Shared Repo</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../data/external-oasis-repos/">Install an OASIS Repo</a>
  
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Data - POSIX Storage</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../../data/gridftp/">Install GridFTP Server</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../data/load-balanced-gridftp/">Install Load Balanced GridFTP</a>
  
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Data - HDFS</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../../data/hadoop-overview/">HDFS Overview</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../data/install-hadoop-2-0-0/">Install HDFS</a>
  
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Data - XRootD</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../../data/xrootd-overview/">XRootD Overview</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../data/install-xrootd/">Install XRootD</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../data/install-xroot-client/">Install XRootD Client</a>
  
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Security</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../../security/lcmaps-voms-authentication/">LCMAPS-VOMS authentication</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../security/host-certs/">Host and Service Certificates</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../security/user-certs/">User Certificates</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../security/certificate-management/">Certificate Management Reference</a>
  
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Common</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../../common/install-best-practices/">Install Best Practices</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../common/ca/">CA Certificates</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../common/yum/">Yum Repos</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../common/openjdk7/">Java 7</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../configuration-with-osg-configure/">Configuration with OSG-Configure</a>
  
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Other</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../gsissh/">GSI-enabled SSH</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../install-gwms-frontend/">GlideinWMS Frontend</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../install-cvmfs-stratum1/">Install a CVMFS Stratum 1</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../network-performance-toolkit/">Network Performance Toolkit</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../troubleshooting-gratia/">Troubleshooting Gratia</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../schedd-filebeats/">Transfer log filebeats installation</a>
  
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Release Information</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../../release/notes/">Release Notes</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../release/release_series/">OSG Release Series</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../release/supported_platforms/">Supported Platforms</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../install-osg-upcoming-software/">OSG upcoming software</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../release/yum-basics/">Yum Basics</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../release/signing/">RPM Signing</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../release/contrib/">Contrib Software</a>
  
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Monitoring</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../../monitoring/install-rsv/">Install RSV</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../monitoring/advanced-rsv-configuration/">Advanced RSV Configuration</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../monitoring/rsv-control/">Manage RSV via rsv-control</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../monitoring/install-rsv-gwms-tester/">RSV GlideinWMS Tester</a>
  
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Deprecated Software</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../../data/bestman-install/">BeStMan Install</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../data/install-bestman-xrootd/">BeStMan Xrootd SE</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../security/edg-mkgridmap/">EDG-Mkgridmap Install</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../security/install-gums/">GUMS</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../worker-node/install-glexec/">Worker node glexec Install</a>
  
        </li>
        <li class=" current">
          
  
    <a class="current" href="./">Install VOMS</a>
  
  <ul class="subnav">
      
    <li class="toctree-l3"><a href="#install-voms">Install VOMS</a></li>
    

    <li class="toctree-l3"><a href="#introduction">Introduction</a></li>
    

    <li class="toctree-l3"><a href="#requirements">Requirements</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#host-and-os">Host and OS</a></li>
        
            <li><a class="toctree-l4" href="#users">Users</a></li>
        
            <li><a class="toctree-l4" href="#certificates">Certificates</a></li>
        
            <li><a class="toctree-l4" href="#networking">Networking</a></li>
        
            <li><a class="toctree-l4" href="#additional-requirements">Additional Requirements</a></li>
        
        </ul>
    

    <li class="toctree-l3"><a href="#installation-procedure">Installation Procedure</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#install-voms_1">Install VOMS</a></li>
        
        </ul>
    

    <li class="toctree-l3"><a href="#configure">Configure</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#configure-mysql-database">Configure MySQL Database</a></li>
        
            <li><a class="toctree-l4" href="#setup-the-service-certificates">Setup the Service Certificates</a></li>
        
            <li><a class="toctree-l4" href="#configure-tomcat-options">Configure Tomcat options</a></li>
        
            <li><a class="toctree-l4" href="#disable-sslv3-in-tomcat">Disable SSLv3 in Tomcat</a></li>
        
            <li><a class="toctree-l4" href="#allow-tomcat-to-have-more-open-files-and-processes">Allow Tomcat to have more open files and processes</a></li>
        
            <li><a class="toctree-l4" href="#configure-trust-manager">Configure Trust Manager</a></li>
        
            <li><a class="toctree-l4" href="#configure-email-services-for-the-voms-server">Configure Email Services for the VOMS Server</a></li>
        
            <li><a class="toctree-l4" href="#add-and-configure-a-vo">Add and configure a VO</a></li>
        
        </ul>
    

    <li class="toctree-l3"><a href="#services">Services</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#starting-and-enabling-services">Starting and Enabling Services</a></li>
        
            <li><a class="toctree-l4" href="#stopping-and-disabling-services">Stopping and Disabling Services</a></li>
        
        </ul>
    

    <li class="toctree-l3"><a href="#advertise-your-voms-server">Advertise your VOMS server</a></li>
    

    <li class="toctree-l3"><a href="#test">Test</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#voms-admin-test">Voms-admin test</a></li>
        
            <li><a class="toctree-l4" href="#voms-core-test">Voms-core test:</a></li>
        
            <li><a class="toctree-l4" href="#testing-edg-mkgridmap">Testing edg-mkgridmap</a></li>
        
            <li><a class="toctree-l4" href="#testing-the-gums-interface">Testing the GUMS interface</a></li>
        
            <li><a class="toctree-l4" href="#removing-a-vo">Removing a VO</a></li>
        
        </ul>
    

    <li class="toctree-l3"><a href="#troubleshooting">Troubleshooting</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#useful-configuration-and-log-files">Useful configuration and log files</a></li>
        
            <li><a class="toctree-l4" href="#fix-these-errors">Fix these errors</a></li>
        
        </ul>
    

    <li class="toctree-l3"><a href="#how-to-get-help">How to get Help?</a></li>
    

    <li class="toctree-l3"><a href="#references">References</a></li>
    

  </ul>
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  
    <a class="" href="../../common/help/">Get Help</a>
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">OSG Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Deprecated Software &raquo;</li>
        
      
    
    <li>Install VOMS</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/opensciencegrid/docs/edit/master/docs/other/install-voms.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="install-voms">Install VOMS<a class="headerlink" href="#install-voms" title="Permanent link">&para;</a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>As of the June 2017 release of OSG 3.4.0, this software is officially deprecated.  Support is scheduled to end as of May 2018.</p>
</div>
<p>This document is for VO System Administrators.</p>
<p>Here we describe how to install and configure VOMS on your Linux machine. When you install VOMS as described here, you get all three parts: MySQL database, VOMS admin and VOMS server. Instructions for creating your VO are also on this page, in the configuration section.</p>
<p>We also describe how to remove a VO from VOMS if the need arises.</p>
<p>The installation section will give you a bare-bones installation. In order to use VOMS you need to go through the configuration: run <code>configure_voms</code> to create your VO, probably enable read-only access to your VO and probably set a VO-admin to add/remove users. The other sections help in troubleshooting and knowing what is running.</p>
<p>This is not a complete reference. If you need to administer a VO, please check the <a href="https://twiki.cern.ch/twiki/bin/view/EMI/EMIVomsAdminUserGuide261">VOMS User guide</a> linked also in the <a href="#reference">reference</a> section.</p>
<h1 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h1>
<p>The <a href="https://twiki.cern.ch/twiki/bin/view/EMI/EMIVomsDocumentation">Virtual Organization Membership Service</a> allows to manage the members of a VO and their privileges (groups and roles). It has three main parts:</p>
<ul>
<li>MySQL database which is a persistent repository for VO membership information,</li>
<li>VOMS admin which provides the Web UI/services to maintain the VO membership. This requires Apache/Tomcat.</li>
<li>VOMS server, a daemon process which services the <em>voms-proxy-init</em> requests.</li>
</ul>
<h1 id="requirements">Requirements<a class="headerlink" href="#requirements" title="Permanent link">&para;</a></h1>
<h2 id="host-and-os">Host and OS<a class="headerlink" href="#host-and-os" title="Permanent link">&para;</a></h2>
<ul>
<li>A host to install the VOMS Service (Pristine node)</li>
<li>OS is Red Hat Enterprise Linux 6, 7, and variants (see <a href="../../release/supported_platforms/">details...</a>). Currently most of our testing has been done on Scientific Linux 5.</li>
<li>Time must be synchronized (e.g. <code>ntpd</code>). </li>
<li>Root access</li>
</ul>
<h2 id="users">Users<a class="headerlink" href="#users" title="Permanent link">&para;</a></h2>
<p>The VOMS and voms-admin installation will create two users unless they are already created.</p>
<table>
<thead>
<tr>
<th>User</th>
<th>Default uid</th>
<th>Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>voms</code></td>
<td>none</td>
<td>Runs the VOMS daemons, one per VO.</td>
</tr>
<tr>
<td><code>tomcat</code></td>
<td>91</td>
<td>Runs tomcat6 and owns voms-admin configuration and certificates.</td>
</tr>
</tbody>
</table>
<p>Note that if uid 91 is already taken but not used for the tomcat user, you will experience errors. <a href="https://github.com/opensciencegrid/docs/blob/master/archive/KnownProblems">Details...</a></p>
<h2 id="certificates">Certificates<a class="headerlink" href="#certificates" title="Permanent link">&para;</a></h2>
<p>You will need two service certificates. <a href="../../security/host-certs">Here</a> are instructions to request a host certificate. </p>
<table>
<thead>
<tr>
<th>Certificate</th>
<th>User that owns certificate</th>
<th>Path to certificate</th>
</tr>
</thead>
<tbody>
<tr>
<td>VOMS service certificate</td>
<td><code>voms</code></td>
<td><code>/etc/grid-security/voms/vomscert.pem</code></td>
</tr>
<tr>
<td><code>/etc/grid-security/voms/vomskey.pem</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Tomcat service certificate</td>
<td><code>tomcat</code></td>
<td><code>/etc/grid-security/http/httpcert.pem</code></td>
</tr>
<tr>
<td><code>/etc/grid-security/http/httpkey.pem</code></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="networking">Networking<a class="headerlink" href="#networking" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Service Name</th>
<th>Protocol</th>
<th>Port Number</th>
<th>Inbound</th>
<th>Outbound</th>
<th>Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td>VOMS</td>
<td>tcp</td>
<td>15001+</td>
<td>Y</td>
<td></td>
<td>range of ports, increment by 1 for each VO supported</td>
</tr>
<tr>
<td>VOMS Admin</td>
<td>tcp</td>
<td>8443</td>
<td>Y</td>
<td></td>
<td>VOMS Admin (which runs within Tomcat) web interface, it must be available to VO administrators and users registering online</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>* 15001 is the port specified in the <a href="#configure">configuration command</a>. You can choose a different one or have multiple ones if you support multiple VOs.</p>
</div>
<h2 id="additional-requirements">Additional Requirements<a class="headerlink" href="#additional-requirements" title="Permanent link">&para;</a></h2>
<ul>
<li>Testing requirements:<ul>
<li>The Subject and Issuer of a voms admin certificate (it could be your certificate)</li>
<li>Access to your own certificate if you want to create your voms proxy</li>
<li>Your certificate uploaded into a browser if you want to test voms-admin WEB UI</li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The configuration and testing require some familiarity with openssl commands, e.g. to extract the subject (DN) and the issuer of a certificate. If you are not familiar please check the guides in the <a href="#reference">reference section</a>:</p>
</div>
<h1 id="installation-procedure">Installation Procedure<a class="headerlink" href="#installation-procedure" title="Permanent link">&para;</a></h1>
<h2 id="install-voms_1">Install VOMS<a class="headerlink" href="#install-voms_1" title="Permanent link">&para;</a></h2>
<ol>
<li>Install Java using <a href="../../common/openjdk7#installing-java">these instructions</a></li>
<li>
<p>Install OSG-VOMS:</p>
<p><code>console
[root@voms ~]$ yum install osg-voms</code></p>
</li>
</ol>
<h1 id="configure">Configure<a class="headerlink" href="#configure" title="Permanent link">&para;</a></h1>
<p>The configuration requires some initial steps plus the addition of one or more VO. You will not be able to start voms-admin if you don't add at least one VO.</p>
<h2 id="configure-mysql-database">Configure MySQL Database<a class="headerlink" href="#configure-mysql-database" title="Permanent link">&para;</a></h2>
<p>Before you will be able configure VOMS you will need to have access to MySQL database. The MySQL software is installed with the <code>osg-voms</code> package. By default it will be using port 3306 and will not have password for <code>root</code>.</p>
<p>It is not necessary to change the port number if you don't want to. If you want to modify the port you will need to edit <code>/etc/my.cnf</code> file and add a new port:</p>
<div class="codehilite"><pre><span></span><span class="k">[mysqld]</span>
<span class="na">datadir</span><span class="o">=</span><span class="s">/var/lib/mysql</span>
<span class="na">socket</span><span class="o">=</span><span class="s">/var/lib/mysql/mysql.sock</span>
<span class="na">port</span><span class="o">=</span><span class="s">MYSQL_PORT_NUMBER</span>
</pre></div>


<p>It is wise to set a password for the <code>root</code> user. Run the following command to set the password:</p>
<div class="codehilite"><pre><span></span><span class="gp">[root@voms ~]$</span> /etc/init.d/mysqld start
<span class="gp">[root@voms ~]$</span> mysqladmin -u root password top_secret
</pre></div>


<h2 id="setup-the-service-certificates">Setup the Service Certificates<a class="headerlink" href="#setup-the-service-certificates" title="Permanent link">&para;</a></h2>
<p>Make sure that you have the host, VOMS and Tomcat service certificates/keys in the right directories and with the correct owners and permissions (<code>600</code> for key and <code>644</code> the certificate). <a href="../../security/host-certs/">Host certificate</a> is required and must be in <code>/etc/grid-security/hostcert.pem</code> and <code>hostkey.pem</code>. It is recommended to provide also service certificates for VOMS and Tomcat. If you don't, here are the instructions to copy the host certificate/key and set the correct owner (permissions are preserved). Note that if you did not previously have a voms or tomcat user on your system, they were added during the RPM install:</p>
<ol>
<li>
<p>VOMS-core daemon is running as user <code>voms</code> and requires its service certificate and key in <code>/etc/grid-security/voms</code>. To copy the host certificate/key for this service, you need to do the following:</p>
<p><code>console
[root@voms ~]$ cd /etc/grid-security
[root@voms ~]$ cp hostcert.pem voms/vomscert.pem
[root@voms ~]$ cp hostkey.pem voms/vomskey.pem
[root@voms ~]$ chown -R voms:voms voms</code></p>
</li>
<li>
<p>Tomcat service is running as user <code>tomcat</code> and requires its service certificate and key in <code>/etc/grid-security/http</code>. To copy the host certificate/key for this service, you need to do the following:</p>
<p><code>console
[root@voms ~]$ cd /etc/grid-security
[root@voms ~]$ mkdir /etc/grid-security/http
[root@voms ~]$ cp hostcert.pem http/httpcert.pem
[root@voms ~]$ cp hostkey.pem http/httpkey.pem
[root@voms ~]$ chown -R tomcat:tomcat http</code></p>
</li>
</ol>
<h2 id="configure-tomcat-options">Configure Tomcat options<a class="headerlink" href="#configure-tomcat-options" title="Permanent link">&para;</a></h2>
<p>Edit <code>/etc/tomcat6/tomcat6.conf</code> to add the following line to the bottom of the file. This is important for good performance and essential if you run more than one VO.</p>
<div class="codehilite"><pre><span></span>CATALINA_OPTS=&quot;<span class="cp">${</span><span class="n">CATALINA_OPTS</span><span class="cp">}</span> -XX:MaxPermSize=256m&quot;
</pre></div>


<p>If you run a large number of VOs, you might need to increase the amount of memory used by Tomcat. You can do this by adding one more line to the bottom of <code>/etc/tomcat6/tomcat6.conf</code>:</p>
<div class="codehilite"><pre><span></span>JAVA_OPTS=&quot;<span class="cp">${</span><span class="n">JAVA_OPTS</span><span class="cp">}</span> -Xmx2048m&quot;
</pre></div>


<p>You must add the following line to <code>/etc/tomcat6/tomcat6.conf</code> to use VOMS-Admin successfully:</p>
<div class="codehilite"><pre><span></span>JAVA_ENDORSED_DIRS=&quot;<span class="cp">${</span><span class="n">JAVA_ENDORSED_DIRS</span><span class="cp">}</span>:/usr/share/voms-admin/endorsed&quot;
</pre></div>


<h2 id="disable-sslv3-in-tomcat">Disable SSLv3 in Tomcat<a class="headerlink" href="#disable-sslv3-in-tomcat" title="Permanent link">&para;</a></h2>
<p>The OSG Security team has concluded that the POODLE SSLv3 vulnerability is not a <strong>critical</strong> concern to OSG software installations. Most services are not affected, and those that are affected are difficult to exploit in a meaningful way. Nonetheless, the recommendation is to disable support for SSLv3 where reasonable.</p>
<p>OSG software includes VOMS Admin Server (currently, version 2.7.0), which runs within Tomcat. By default Tomcat allows SSLv3 connections, but that is easy to change. To disable SSLv3 support from a Tomcat instance that contains VOMS Admin Server, set <code>protocols="TLSv1.1,TLSv1.2"</code> in <code>/etc/tomcat[56]/server.xml</code>, as shown below.</p>
<p>Note: OSG Software has tested this change only for Tomcat and VOMS Admin Server. But this is a server-level Tomcat configuration change and thus affects all Tomcat web applications running on the same server. For now, we recommend making this change to Tomcat servers that run only VOMS Admin Server. There are known issues with applying this change to a Tomcat instance that runs GUMS, in that dCache clients (at least) fail to work with the changed GUMS server.</p>
<div class="codehilite"><pre><span></span><span class="gd">--- server.xml.old      2014-10-28 11:27:11.000000000 -0500</span>
<span class="gi">+++ server.xml  2014-10-28 11:29:34.000000000 -0500</span>
<span class="gu">@@ -20,19 +20,20 @@</span>
     &lt;Connector port=&quot;8443&quot; SSLEnabled=&quot;true&quot;
               maxThreads=&quot;150&quot; minSpareThreads=&quot;25&quot; maxSpareThreads=&quot;75&quot;
               enableLookups=&quot;false&quot; disableUploadTimeout=&quot;true&quot;
               acceptCount=&quot;100&quot; debug=&quot;0&quot; scheme=&quot;https&quot; secure=&quot;true&quot;
               sSLImplementation=&quot;org.glite.security.trustmanager.tomcat.TMSSLImplementation&quot;
               trustStoreDir=&quot;/etc/grid-security/certificates&quot;
               sslCertFile=&quot;/etc/grid-security/http/httpcert.pem&quot;
               sslKey=&quot;/etc/grid-security/http/httpkey.pem&quot;
               crlUpdateInterval=&quot;2h&quot;
               log4jConfFile=&quot;/usr/share/tomcat6/conf/log4j-trustmanager.properties&quot;
               clientAuth=&quot;true&quot; sslProtocol=&quot;TLS&quot; sslEnabledProtocols=&quot;TLSv1&quot;
<span class="gi">+              protocols=&quot;TLSv1.1,TLSv1.2&quot;</span>
               crlEnabled=&quot;true&quot; crlRequired=&quot;true&quot;/&gt;

    &lt;Engine name=&quot;Catalina&quot; defaultHost=&quot;localhost&quot;&gt;

      &lt;Host name=&quot;localhost&quot; appBase=&quot;webapps&quot; /&gt;
    &lt;/Engine&gt;
  &lt;/Service&gt;
&lt;/Server&gt;
</pre></div>


<h2 id="allow-tomcat-to-have-more-open-files-and-processes">Allow Tomcat to have more open files and processes<a class="headerlink" href="#allow-tomcat-to-have-more-open-files-and-processes" title="Permanent link">&para;</a></h2>
<p>If you run several VOs, you may need to extend the limits for Tomcat so that it can open more file and create more processes. To do this, add the following lines to <code>/etc/security/limits.conf</code>:</p>
<div class="codehilite"><pre><span></span>tomcat          soft    nofile  63536
tomcat          hard    nofile  63536

tomcat          soft    nproc   16384
tomcat          hard    nproc   16384
</pre></div>


<p>Note that this is not needed if you are running just a single VO, this is only needed if you run many VOs.</p>
<h2 id="configure-trust-manager">Configure Trust Manager<a class="headerlink" href="#configure-trust-manager" title="Permanent link">&para;</a></h2>
<p>Configure Tomcat's trust manager. This must be done once, before starting up Tomcat for the first time:</p>
<ol>
<li>
<p>You have to configure Tomcat in order to enable EMI trustmanager:</p>
<p><code>console
[root@voms ~]$ /var/lib/trustmanager-tomcat/configure.sh
Info: using default install root: /
Info: using default configuration file: //var/lib/trustmanager-tomcat/config.properties
Info: using default configuration directory: //var/lib/trustmanager-tomcat
Info: you can clean up using the following commands
      mv -f /etc/tomcat5/server.xml.old-trustmanager /etc/tomcat5/server.xml
      rm -f /usr/share/tomcat5/server/lib/bcprov*.jar
      rm -f /usr/share/tomcat5/server/lib/log4j*.jar
      rm -f /usr/share/tomcat5/server/lib/trustmanager-*.jar
      rm -f /etc/tomcat5/log4j-trustmanager.properties
      rm -f //var/lib/trustmanager-tomcat/server.xml</code></p>
</li>
</ol>
<p>(the output may look different on EL6)</p>
<h2 id="configure-email-services-for-the-voms-server">Configure Email Services for the VOMS Server<a class="headerlink" href="#configure-email-services-for-the-voms-server" title="Permanent link">&para;</a></h2>
<p>The VOMS server may need to send administrative emails. To enable this feature <strong>on EL 6 systems</strong>, you must complete a one-time initialization of Java email services within Tomcat:</p>
<ol>
<li>
<p>Run the <code>build-jar-repository</code> command:</p>
<p><code>console
[root@voms ~]$ /usr/bin/build-jar-repository /usr/share/tomcat6/lib javamail</code></p>
</li>
<li>
<p>Set the hostname for reminder e-mails in <code>/etc/voms-admin/VO_NAME/voms.service.properties</code>:</p>
<p><code>file
voms.hostname = &lt;hostname&gt;</code></p>
<p>Replacing <hostname> with the public hostname of your VOMS server.</p>
</li>
</ol>
<p>EL 5 systems are already configured to use Java email services.</p>
<h2 id="add-and-configure-a-vo">Add and configure a VO<a class="headerlink" href="#add-and-configure-a-vo" title="Permanent link">&para;</a></h2>
<p>You must add at least one VO before you can start VOMS Admin. You must start the services as instructed during the configuration steps. You can stop them at the end if you don't want them running yet.</p>
<ol>
<li>
<p>Run <code>voms-admin-configure</code> script to create a new VO. Note that if you have multiple VOs, each VO must have a unique VOMS_PORT</p>
<p><code>console
[root@voms ~]$ voms-admin-configure install \
    --dbtype mysql \
    --vo VO_NAME \
    --createdb \
    --deploy-database  \
    --dbauser root  \
    --dbapwd MYSQL_ROOT_PASSD \
    --dbusername  admin-VO_NAME \
    --dbpassword secret  \
    --dbport  DB_PORT \
    --port VOMS_PORT  \
    --mail-from email \
    --smtp-host smtp.domain \
    --sqlloc /usr/lib64/voms/libvomsmysql.so \
    --cert /etc/grid-security/voms/vomscert.pem \
    --key  /etc/grid-security/voms/vomskey.pem \
    --read-access-for-authenticated-clients</code></p>
<p>For example for the test1 VO:</p>
<p><code>console
[root@voms ~]$ voms-admin-configure install --dbtype mysql --vo test1 --createdb \
     --deploy-database --dbauser root --dbapwd  top_secret \
     --dbusername admin_test1 --dbpassword secret --dbport 3306 \
     --port 15001 --mail-from tlevshin@fnal.gov --smtp-host smtp.fnal.gov \
     --sqlloc /usr/lib64/voms/libvomsmysql.so --cert /etc/grid-security/voms/vomscert.pem \
     --key  /etc/grid-security/voms/vomskey.pem --read-access-for-authenticated-clients</code></p>
<p>If the command fails with a <code>IOError: [Errno 32] Broken pipe</code> error, check that you entered the correct database password.
If the above command is executed correctly a lot of sql stuff will scroll across the screen, followed by</p>
<p>``` console
Deploying voms database...
Database deployed correctly!</p>
<p>VO test1 installation finished.</p>
<p>You can start the voms services using the following commands:
    /etc/init.d/voms start test1
    /etc/init.d/voms-admin start test1
```</p>
</li>
<li>
<p>Start VOMS and VOMS Admin for the VO you just added:</p>
<p><code>console
[root@voms ~]$ /sbin/service voms start VO_NAME
[root@voms ~]$ /sbin/service voms-admin start VO_NAME</code></p>
<p>For example:</p>
<p><code>console
[root@voms ~]$ /sbin/service voms start test1
[root@voms ~]$ /sbin/service voms-admin start test1</code></p>
<p>Note that the voms-admin init script really isn't an init script. Instead it deploys a Tomcat webapp into Tomcat. In normal usage, you never need to run this command again, and you should <em>not</em> run <code>/sbin/service voms-admin stop VO_NAME</code>.</p>
</li>
<li>
<p>Add a local admin:</p>
<p><code>console
[root@voms ~]$ /usr/sbin/voms-db-deploy.py add-admin --vo VO_NAME  \
        --dn  HOST_CERT_SUBJECT \
        --ca HOST_CERT_ISSUER</code></p>
<p>For example:</p>
<p><code>console
[root@voms ~]$ /usr/sbin/voms-db-deploy.py add-admin --vo test1 \
     --dn /DC=org/DC=doegrids/OU=Services/CN=fermicloud002.fnal.gov \
     --ca "/DC=org/DC=DOEGrids/OU=Certificate Authorities/CN=DOEGrids CA 1"</code></p>
</li>
<li>
<p>In order to complete the next step you need to start also Tomcat if it is not already running. And since Tomcat requires valid CRLs you need to fetch the CRLs if it is a fresh installation they are not there:</p>
<p><code>console
[root@voms ~]$ /usr/sbin/fetch-crl  # If there are no CRLs in /etc/grid-security/certificates
[root@voms ~]$ /sbin/service tomcat6 start</code></p>
</li>
<li>
<p>Configure VOMS Admin to allow GUMS and edg-mkgridmap to query your VO for the set of users. Note that you must have a valid certificate; voms-admin needs a certificate authorized to perform the operation (ACL editing) on the VO:</p>
<p><code>console
[root@voms ~]$ voms-admin --nousercert --vo VO_NAME add-ACL-entry /VO_NAME ANYONE VOMS_CA "CONTAINER_READ,MEMBERSHIP_READ" true</code></p>
<p>For example:</p>
<p><code>console
[root@voms ~]$ voms-admin --nousercert --vo test1 add-ACL-entry /test1 ANYONE VOMS_CA "CONTAINER_READ,MEMBERSHIP_READ" true</code></p>
</li>
<li>
<p>Allow compatibility with <code>GUMS</code> and <code>edg-mkgridmap</code>. Edit <code>/etc/voms-admin/VO_NAME/voms.service.properties</code> by adding the following line to the file:</p>
<p><code>console
voms.csrf.log_only = true</code></p>
</li>
</ol>
<p>If you don't want to leave your services running you can stop them after you are done with adding the VO:</p>
<div class="codehilite"><pre><span></span><span class="gp">[root@voms ~]$</span> /sbin/service voms stop
<span class="gp">[root@voms ~]$</span> /sbin/service tomcat6 stop
</pre></div>


<h1 id="services">Services<a class="headerlink" href="#services" title="Permanent link">&para;</a></h1>
<p>VOMS has its persistent repository in a MySQL database, that requires <code>mysql</code> to be running in order to be queried. All grid interactions require updated CA certificates and CRLs. Then the <em>voms server</em> is a daemon servicing authentication requests and <em>voms-admin</em>, requiring Tomcat, is a Web UI/service to manage the VO membership.</p>
<h2 id="starting-and-enabling-services">Starting and Enabling Services<a class="headerlink" href="#starting-and-enabling-services" title="Permanent link">&para;</a></h2>
<p>To start VOMS you need to start several services:</p>
<ol>
<li>
<ol>
<li>MySQL server needs to be running if it is not already:</li>
</ol>
<p><code>console
[root@voms ~]$ /sbin/service mysqld start</code></p>
</li>
<li>
<p>Start voms server</p>
<p><code>console
[root@voms ~]$ service voms start</code></p>
</li>
<li>
<p>Start Tomcat, required by voms-admin:</p>
<p><code>console
[root@voms ~]$ service tomcat6 start</code></p>
</li>
</ol>
<p>You should also enable the appropriate services so that they are automatically started when your system is powered on:</p>
<ul>
<li>
<ul>
<li>To enable the other services:</li>
</ul>
<p><code>console
[root@voms ~]$ /sbin/chkconfig mysqld on
[root@voms ~]$ /sbin/chkconfig voms on
[root@voms ~]$ /sbin/chkconfig tomcat6 on</code></p>
</li>
</ul>
<p><strong>Note</strong>: You do <em>not</em> need to run chkconfig on the voms-admin service. This service is only need to do the initial "deployment" of the VOMS Admin service into Tomcat and is not needed thereafter unless you add another VO.</p>
<h2 id="stopping-and-disabling-services">Stopping and Disabling Services<a class="headerlink" href="#stopping-and-disabling-services" title="Permanent link">&para;</a></h2>
<p>To stop VOMS you need to stop voms and voms-admin, and also the services they use if nothing else is using them:</p>
<ol>
<li>
<p>Stop voms server</p>
<p><code>console
[root@voms ~]$ service voms stop</code></p>
</li>
<li>
<p>, Stop Tomcat, if no other application is using it:</p>
<p><code>console
[root@voms ~]$ service tomcat6 stop</code></p>
</li>
<li>
<p>Stop MySQL server if no other application is using it:</p>
<p><code>console
[root@voms ~]$ service mysqld stop</code></p>
</li>
<li>
<p>In addition, you can disable services by running the following commands. However, you don't need to do this normally.</p>
</li>
<li>
<ul>
<li>To disable the other services:</li>
</ul>
<p><code>console
[root@voms ~]$ /sbin/chkconfig mysqld off
[root@voms ~]$ /sbin/chkconfig voms off
[root@voms ~]$ /sbin/chkconfig tomcat6 off</code></p>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You do not need to run chkconfig on the voms-admin service. See above for more details.</p>
</div>
<h1 id="advertise-your-voms-server">Advertise your VOMS server<a class="headerlink" href="#advertise-your-voms-server" title="Permanent link">&para;</a></h1>
<p>A working VOMS server can be contacted to sign certificates extensions (e.g., by <code>voms-proxy-init</code>) or to verify VO memberships only if it is on the list of valid VOMS servers (<code>/etc/vomses</code>) and if there is an LSC file for that VO. Some grid services (glite-FTS and glite-WMS) even require a copy of the VOMS server certificate.</p>
<p>The file <code>/etc/vomses</code> contains a list of VOs and their VOMS servers. A VOMS server may appear on multiple lines if it is serving multiple VOs on different ports. All lines contain:</p>
<div class="codehilite"><pre><span></span>&quot;alias&quot; &quot;HOST_NAME&quot; &quot;PORT&quot; &quot;HOST_DN&quot; &quot;VO_NAME&quot;
</pre></div>


<p>For example:</p>
<div class="codehilite"><pre><span></span>&quot;test1&quot; &quot;fermicloud002.fnal.gov&quot; &quot;15001&quot; &quot;/DC=org/DC=doegrids/OU=Services/CN=fermicloud002.fnal.gov&quot; &quot;test1&quot;
</pre></div>


<p>The <a href="https://twiki.cern.ch/twiki/bin/view/LCG/VOMSLSCfileConfiguration">LSC file</a> (LiSt of Certificates) is another description of your VOMS server:</p>
<ul>
<li>It is located in <code>$X509_VOMS_DIR/${VO}</code>, by default <code>/etc/grid-security/vomsdir/${VO}</code></li>
<li>The filename is the fully qualified hostname (FQDN) of your server, followed by <code>.lsc</code></li>
<li>The first line contains the subject DN of the VOMS server host certificate, without quotes</li>
<li>The second line contains the subject DN of the CA that issued the VOMS server host certificate, also without quotes</li>
</ul>
<p>For example, for the VO named <code>test1</code> hosted on <code>fermicloud002</code>, the LSC file named <code>/etc/grid-security/vomsdir/test1/fermicloud002.fnal.gov.lsc</code> might contain:</p>
<div class="codehilite"><pre><span></span>/DC=org/DC=doegrids/OU=Services/CN=fermicloud002.fnal.gov
/DC=org/DC=DOEGrids/OU=Certificate Authorities/CN=DOEGrids CA 1
</pre></div>


<p>The VOMS server manager must distribute the line for <code>/etc/vomses</code> and the LSC file to all hosts that will contact the VOMS server. OSG distributes with all its client and server installations a default list of VOMS servers (<code>/etc/vomses</code>) and a default set of LSC files. These are part of the <code>vo-client</code> RPM.</p>
<p>To be included, use the VO Registration function at <a href="https://oim.opensciencegrid.org/oim/vo">OIM VO Registration</a>. Even if you are already registered as a VO you need to notify the Grid Operations Center if the information in the vomses file or the LSC file has changed.</p>
<h1 id="test">Test<a class="headerlink" href="#test" title="Permanent link">&para;</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Before performing any of the tests you must start all the services as <a href="#starting-and-enabling-services">described above</a></p>
</div>
<p>To test VOMS you can add a member (her/his certificate) to a VO using voms-admin, login in the Web UI and then:</p>
<ul>
<li>use the voms server to generate a proxy for that certificate.</li>
<li>or generate a grid-mapfile</li>
<li>or query with GUMS</li>
</ul>
<h2 id="voms-admin-test">Voms-admin test<a class="headerlink" href="#voms-admin-test" title="Permanent link">&para;</a></h2>
<p>Add a member(yourself) to the VO:</p>
<div class="codehilite"><pre><span></span><span class="gp">[root@voms ~]$</span> voms-admin --vo VO_NAME --host HOST_NAME <span class="se">\</span>
       --nousercert create-user USER_CERT_SUBJECT USER_CERT_ISSUER <span class="se">\</span>
       USER_COMMON_NAME email 
</pre></div>


<p>For example:</p>
<div class="codehilite"><pre><span></span><span class="gp">[root@voms ~]$</span> voms-admin --vo test1 --host fermicloud002 --nousercert create-user <span class="se">\</span>
   <span class="s2">&quot;/DC=org/DC=doegrids/OU=People/CN=Joe Doe 12345&quot;</span> <span class="s2">&quot;/DC=org/DC=DOEGrids/OU=Certificate Authorities/CN=DOEGrids CA 1&quot;</span> 
<span class="go">   &quot;Joe Doe 12345&quot; &#39;jdoe@fnal.gov&#39;</span>
</pre></div>


<p>Assign VOAdmin role to yourself, so you can manage the VO using the Web UI:</p>
<div class="codehilite"><pre><span></span><span class="go">voms-admin --vo VO_NAME --host HOST_NAME \</span>
<span class="go">    --nousercert assign-role  /VO_NAME  VO-Admin  \</span>
<span class="go">      USER_CERT_SUBJECT USRT_CERT_ISSUER </span>
</pre></div>


<p>For example:</p>
<div class="codehilite"><pre><span></span><span class="gp">[root@voms ~]$</span> voms-admin --vo test1 --host fermicloud002 --nousercert assign-role /test1   VO-Admin  <span class="se">\</span>
   <span class="s2">&quot;/DC=org/DC=doegrids/OU=People/CN=Joe Doe 12345&quot;</span> <span class="s2">&quot;/DC=org/DC=DOEGrids/OU=Certificate Authorities/CN=DOEGrids CA 1&quot;</span> 
</pre></div>


<p>Check the Web UI by accessing <code>https://hostname:8443/voms/voname</code>. If you have your certificate loaded into the browser you will be able to manage the VO.</p>
<h2 id="voms-core-test">Voms-core test:<a class="headerlink" href="#voms-core-test" title="Permanent link">&para;</a></h2>
<p>To perform this test you need the <code>voms-client</code> RPM.</p>
<p>To use your VOMS you need to add a line with its description (similar to the following) to <code>/etc/vomses</code>, a file containing a list of all valid voms servers:</p>
<div class="codehilite"><pre><span></span>&quot;alias&quot; &quot;HOST_NAME&quot; &quot;PORT&quot; &quot;HOST DN&quot; &quot;VO_NAME&quot;
</pre></div>


<p>Look at <code>/etc/voms-admin/VO_NAME/vomses</code> to find the correct line for your VO. For example:</p>
<div class="codehilite"><pre><span></span>&quot;test1&quot; &quot;fermicloud002.fnal.gov&quot; &quot;15001&quot; &quot;/DC=org/DC=doegrids/OU=Services/CN=fermicloud002.fnal.gov&quot; &quot;test1&quot;
</pre></div>


<p>If it is not there already, add your certificate to the VO using <code>voms-admin</code> <code>create-user</code> as in the previous section. Being the local admin set with <code>voms-db-deploy.py add-admin</code> does not add the certificate to the VO.</p>
<p>Use <code>voms-proxy-init</code> to generate proxy. Login as user, create <code>vomses</code> file (e.g. <code>~/.vomses</code>). Generate voms proxy</p>
<div class="codehilite"><pre><span></span><span class="gp">[user@voms ~]$</span> voms-proxy-init -voms VO_NAME -vomses ~/vomses
</pre></div>


<h2 id="testing-edg-mkgridmap">Testing edg-mkgridmap<a class="headerlink" href="#testing-edg-mkgridmap" title="Permanent link">&para;</a></h2>
<p>The <code>edg-mkgridmap</code> command is run on a site's Compute Element node to generate a <code>grid-mapfile</code> file. This script is not provided as a part of the VOMS installation, so you will have to go on a CE node to test this. You do not have to be the <code>root</code> user on the CE node, but you will need to have a personal certificate available.</p>
<p>The <code>mkgridmap</code> file syntax/values for each VO you create, can be viewed on the WEB UI for your VO by selecting <code>Configuration information</code> on the left hand menu of the main page. You will get a line like:</p>
<div class="codehilite"><pre><span></span> group vomss://HOST_NAME:8443/voms/VO_NAME  group_name
</pre></div>


<p>e.g. for the OSG VO :</p>
<div class="codehilite"><pre><span></span> group vomss://cms-xen3.fnal.gov:8443/voms/OSG  osg
</pre></div>


<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>osg</code> (3rd token) is an EDG format for the account name. You will likely want to change it to the group unix account you want assigned for your CE node. The example above is for a <code>group</code> account assignment.</p>
</div>
<p>To test, you will need to do this on a CE node where the authorization mode is "gridmap" (lcmaps or PRIMA are not enabled):</p>
<ol>
<li>
<p>Populate <code>/etc/edg-mkgridmap.conf</code> with the example configuration file on your VOMS server. It will be the only entry.</p>
<p><code>console
[root@voms ~]$ echo 'group vomss://cms-xen3.fnal.gov:8443/voms/OSG  osg' &gt; /etc/edg-mkgridmap.conf</code></p>
</li>
<li>
<p>Execute edg-mkgridmap:</p>
<p><code>console
[root@voms ~]$ edg-mkgridmap
  ... the output will be in /etc/grid-security/grid-mapfile and will look as follows ...
  "/DC=org/DC=doegrids/OU=People/CN=John Weigand 458491"  vdt
  "/DC=org/DC=doegrids/OU=Services/CN=cms-xen3.fnal.gov"  vdt</code></p>
</li>
</ol>
<p>You can find more in the <a href="../../compute-element/install-htcondor-ce">compute element install document</a>.</p>
<h2 id="testing-the-gums-interface">Testing the GUMS interface<a class="headerlink" href="#testing-the-gums-interface" title="Permanent link">&para;</a></h2>
<p>The GUMS authorization server periodically 'pulls' the VO membership data for it's authorization and account assignment functions from the various VO's VOMS servers.</p>
<p>Unfortunately, there is no way of testing this except with an installed GUMS server which this document does not address.</p>
<p>See the <a href="../../security/install-gums">GUMS install guide</a> for more information.</p>
<h2 id="removing-a-vo">Removing a VO<a class="headerlink" href="#removing-a-vo" title="Permanent link">&para;</a></h2>
<p>If you added the VO just for testing purposes, you can remove it using <code>voms-admin-configure remove --vo VONAME</code> as documented in the <a href="https://twiki.cern.ch/twiki/bin/view/EMI/EMIVomsAdminUserGuide261#Removing_a_VO">user guide</a>, e.g.:</p>
<div class="codehilite"><pre><span></span><span class="gp">#</span><span class="c1"># Stop the service </span>
<span class="gp">[root@voms ~]$</span> service voms-admin stop test1
<span class="gp">[root@voms ~]$</span> service voms stop test1  
<span class="gp">#</span><span class="c1"># Remove it.</span>
<span class="gp">[root@voms ~]$</span> voms-admin-configure remove --vo test1 --undeploy-database --dropdb --dbapwd top_secret
<span class="go">voms-admin-configure, version 2.6.1</span>

<span class="go">Removing vo  test1</span>
<span class="go">VO test1 succesfully removed.</span>
<span class="gp">#</span><span class="c1"># Restart to update the voms-server webpage </span>
<span class="gp">[root@voms ~]$</span> service tomcat6 restart
</pre></div>


<p>Note that the --undeploy-database and --dropdb will remove the database that stores all the membership information. You cannot undo this option. If you're not quite sure that you really want to remove the database, then do not pass this option. The VO will be unaccessible and unusable, but the membership information will be retained in case you recreate the VO later.</p>
<h1 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link">&para;</a></h1>
<h2 id="useful-configuration-and-log-files">Useful configuration and log files<a class="headerlink" href="#useful-configuration-and-log-files" title="Permanent link">&para;</a></h2>
<p>Configuration Files</p>
<table>
<thead>
<tr>
<th>Service or Process</th>
<th>Configuration File</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>voms</td>
<td><code>/etc/voms/VO_NAME/voms.conf</code></td>
<td></td>
</tr>
<tr>
<td><code>/etc/voms/VO_NAME/voms.pass</code></td>
<td>VOMS server configuration and password for the VO database</td>
<td></td>
</tr>
<tr>
<td>voms-admin</td>
<td><code>/etc/voms-admin/voms-siblings.xml</code></td>
<td>Auxiliary voms-admin application configuration</td>
</tr>
<tr>
<td></td>
<td><code>/etc/voms-admin/VO_NAME/logback.runtime.xml</code></td>
<td>Logging configuration</td>
</tr>
<tr>
<td></td>
<td><code>/etc/voms-admin/VO_NAME/vo-aup.txt</code></td>
<td>VO acceptable use policy</td>
</tr>
<tr>
<td></td>
<td><code>/etc/voms-admin/VO_NAME/voms-admin-VO_NAME.xml</code></td>
<td></td>
</tr>
<tr>
<td><code>/etc/voms-admin/VO_NAME/voms.service.properties</code></td>
<td>VOMS Admin configuration</td>
<td></td>
</tr>
<tr>
<td></td>
<td><code>/etc/voms-admin/VO_NAME/voms.database.properties</code></td>
<td>VO database handler configuration</td>
</tr>
<tr>
<td></td>
<td><code>/etc/voms-admin/VO_NAME/vomses</code></td>
<td>vomses line</td>
</tr>
<tr>
<td>mysql</td>
<td><code>/var/lib/mysql/VO_NAME</code></td>
<td>VOMS database for the VO</td>
</tr>
<tr>
<td></td>
<td><code>/etc/my.cnf</code></td>
<td>MySQL configuration, e.g. server port</td>
</tr>
<tr>
<td>tomcat</td>
<td><code>/etc/tomcat6/</code></td>
<td>Tomcat configuration files</td>
</tr>
<tr>
<td></td>
<td><code>/etc/tomcat6/Catalina/localhost/*</code></td>
<td>VOMS related tomcat configuration</td>
</tr>
</tbody>
</table>
<p>Log files</p>
<table>
<thead>
<tr>
<th>Service or Process</th>
<th>Log File</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td><code>/var/log/tomcat5/voms-admin-VO_NAME.log</code></td>
<td>This is the vo-by-vo log for voms-admin Web UI</td>
</tr>
<tr>
<td></td>
<td><code>/var/log/tomcat5/trustmanager.log</code></td>
<td>The trustmanager handles things related to authentication. Useful errors are sometimes here.</td>
</tr>
<tr>
<td>tomcat</td>
<td><code>/var/log/tomcat6/catalina.out</code></td>
<td>This is the Tomcat log file. Problems (and a lot of noise) are reported here.</td>
</tr>
<tr>
<td></td>
<td><code>/var/log/tomcat6/voms-admin-VO_NAME.log</code></td>
<td>This is the vo-by-vo log for voms-admin Web UI</td>
</tr>
<tr>
<td></td>
<td><code>/var/log/tomcat6/trustmanager.log</code></td>
<td>The trustmanager handles things related to authentication. Useful errors are sometimes here.</td>
</tr>
<tr>
<td>voms</td>
<td><code>/var/log/voms/voms.VO_NAME</code></td>
<td>This is the log of the VOMS daemon for each VO</td>
</tr>
</tbody>
</table>
<h2 id="fix-these-errors">Fix these errors<a class="headerlink" href="#fix-these-errors" title="Permanent link">&para;</a></h2>
<h3 id="voms-server-for-vo95name-not-known">VOMS Server for VO_NAME not known!<a class="headerlink" href="#voms-server-for-vo95name-not-known" title="Permanent link">&para;</a></h3>
<p>If you saw an error like "VOMS Server for VO_NAME not known!" probably you did not add the VO VO_NAME (e.g. test1) to <code>/etc/vomses</code></p>
<h3 id="tomcat-is-not-starting">Tomcat is not starting<a class="headerlink" href="#tomcat-is-not-starting" title="Permanent link">&para;</a></h3>
<p>If Tomcat is not starting and <code>/var/log/tomcat5/catalina.out</code> contains an error like "/usr/bin/tomcat5: line 331: /usr/lib/java/bin/java: No such file or directory", then you may have to uncomment the line <code>JAVA_HOME="/usr/lib/jvm/java"</code> in <code>/etc/tomcat5/tomcat5.conf</code>. The Jpackage repository is known to provide a misconfigured tomcat5 package.</p>
<h3 id="problems-running-voms-admin">Problems running voms-admin<a class="headerlink" href="#problems-running-voms-admin" title="Permanent link">&para;</a></h3>
<p>Verify if voms-admin was configured and started correctly:</p>
<ul>
<li>If voms-admin is not responding and you get a "Socket error 111" try restarting tomcat6 and voms-admin</li>
<li>If there are BC (bouncycastle) related errors in Tomcat's log file (<code>/var/log/tomcat6/catalina.out</code>), the trust manager may not be configured correctly. Try to run <code>/var/lib/trustmanager-tomcat/configure.sh</code>.</li>
<li>If there are OpenSAML or XML parser related errors in Tomcat's log file (<code>/var/log/tomcat6/catalina.out</code>), the JAVA_ENDORSED_DIRS variable may not be set in <code>/etc/tomcat6/tomcat6.conf</code>. See the <strong>Configure Tomcat options</strong> section above.</li>
<li>If you get an error like "Socket error: (1, 'error:14094416:SSL routines:SSL3_READ_BYTES:sslv3 alert certificate unknown')" probably you have no CRLs for your CA certificates. You can see in <code>/var/log/tomcat6/trustmanager.log</code> that Tomcat is discarding CA certificates without CRL. Run <code>fetch-crl</code>.</li>
</ul>
<h3 id="wrong-urls-in-voms-admin-pagesconnection-timed-outhost-unavailable">Wrong URLs in VOMS admin pages/Connection timed out/Host unavailable<a class="headerlink" href="#wrong-urls-in-voms-admin-pagesconnection-timed-outhost-unavailable" title="Permanent link">&para;</a></h3>
<p>If you can reach the first page but all the links are failing, check the URL in the links. Tomcat by default constructs the absolute URLs in the web pages using the hostname/IP and port used for the request. If the server resides behind a Firewall or NAT that enforces port redirection, these may be the server IP or the port on the private network, that likely are not reachable by your Web browser. To fix the problem you must use <a href="http://tomcat.apache.org/tomcat-5.5-doc/config/http.html#Proxy_Support">Tomcat's proxy support</a> by setting <code>proxyName</code> and/or <code>proxyPort</code> in Tomcat's configuration file (<code>/etc/tomcat5/server.xml</code>).</p>
<p>After changing <code>server.xml</code> <a href="#services">stop and restart</a> Tomcat in order for the changes to take effect.</p>
<h1 id="how-to-get-help">How to get Help?<a class="headerlink" href="#how-to-get-help" title="Permanent link">&para;</a></h1>
<p>To get assistance please use <a href="../../common/help/">Help Procedure</a>.</p>
<h1 id="references">References<a class="headerlink" href="#references" title="Permanent link">&para;</a></h1>
<p>EMI documentation:</p>
<ul>
<li><a href="https://twiki.cern.ch/twiki/bin/view/EMI/EMIVomsDocumentation">EMI VOMS documentation</a></li>
<li><a href="https://twiki.cern.ch/twiki/bin/view/EMI/EMIVomsAdminUserGuide261">VOMS Admin User Guide</a></li>
<li><a href="https://twiki.cern.ch/twiki/bin/view/EMI/VOMSystemAdministratorGuide">VOMS System Admin Guide</a></li>
<li><a href="https://twiki.cern.ch/twiki/bin/view/LCG/VOMSLSCfileConfiguration">How to configure VOMS LSC files</a></li>
</ul>
<p>Openssl commands:</p>
<p><a href="http://security.ncsa.illinois.edu/research/grid-howtos/usefulopenssl.html">http://security.ncsa.illinois.edu/research/grid-howtos/usefulopenssl.html</a></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../common/help/" class="btn btn-neutral float-right" title="Get Help">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../../worker-node/install-glexec/" class="btn btn-neutral" title="Worker node glexec Install"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/opensciencegrid/docs/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../../worker-node/install-glexec/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../common/help/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/require.js"></script>
      <script src="../../search/search.js"></script>

</body>
</html>
