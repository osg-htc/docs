
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://osg-htc.org/docs/data/stashcache/run-stashcache-container/">
      
      <link rel="icon" href="../../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.8">
    
    
      
        <title>Running OSDF Cache in a Container - OSG Site Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.644de097.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../css/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-69012-29","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
  <script async src="https://www.google-analytics.com/analytics.js"></script>


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#running-osdf-cache-in-a-container" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="OSG Site Documentation" class="md-header__button md-logo" aria-label="OSG Site Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OSG Site Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Running OSDF Cache in a Container
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/osg-htc/docs/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="OSG Site Documentation" class="md-nav__button md-logo" aria-label="OSG Site Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    OSG Site Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/osg-htc/docs/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../site-planning/" class="md-nav__link">
        Site Planning
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../site-verification/" class="md-nav__link">
        Site Verification
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../site-maintenance/" class="md-nav__link">
        Site Maintenance
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../common/help/" class="md-nav__link">
        Help / Security Incidents
      </a>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Registration
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Registration" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Registration
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../common/contact-registration/" class="md-nav__link">
        Contact Information
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../common/registration/" class="md-nav__link">
        Resources and Collaborations
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          Resource Sharing
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Resource Sharing" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Resource Sharing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_1" type="checkbox" id="__nav_7_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_1">
          Compute
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Compute" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_1">
          <span class="md-nav__icon md-icon"></span>
          Compute
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../resource-sharing/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_1_2" type="checkbox" id="__nav_7_1_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_1_2">
          Pilot Containers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Pilot Containers" data-md-level="3">
        <label class="md-nav__title" for="__nav_7_1_2">
          <span class="md-nav__icon md-icon"></span>
          Pilot Containers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../resource-sharing/os-backfill-containers/" class="md-nav__link">
        Site Backfill
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../resource-sharing/user-containers/" class="md-nav__link">
        User Allocations
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_1_3" type="checkbox" id="__nav_7_1_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_1_3">
          Compute Entrypoint
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Compute Entrypoint" data-md-level="3">
        <label class="md-nav__title" for="__nav_7_1_3">
          <span class="md-nav__icon md-icon"></span>
          Compute Entrypoint
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../compute-element/htcondor-ce-overview/" class="md-nav__link">
        HTCondor-CE Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../compute-element/hosted-ce/" class="md-nav__link">
        Request a Hosted CE
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../compute-element/install-htcondor-ce/" class="md-nav__link">
        Install HTCondor-CE
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_1_4" type="checkbox" id="__nav_7_1_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_1_4">
          Worker Node
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Worker Node" data-md-level="3">
        <label class="md-nav__title" for="__nav_7_1_4">
          <span class="md-nav__icon md-icon"></span>
          Worker Node
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../worker-node/using-wn/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../worker-node/install-wn/" class="md-nav__link">
        Install from RPM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../worker-node/install-wn-tarball/" class="md-nav__link">
        Install from Tarball
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../worker-node/install-wn-oasis/" class="md-nav__link">
        Install from OASIS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../worker-node/install-cvmfs/" class="md-nav__link">
        Install CVMFS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../worker-node/install-apptainer/" class="md-nav__link">
        Install Apptainer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../worker-node/using-wn-containers/" class="md-nav__link">
        Using WN Containers
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_2" type="checkbox" id="__nav_7_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_2">
          Data
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Data" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_2">
          <span class="md-nav__icon md-icon"></span>
          Data
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_2_1" type="checkbox" id="__nav_7_2_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_2_1">
          HTTP & OASIS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="HTTP & OASIS" data-md-level="3">
        <label class="md-nav__title" for="__nav_7_2_1">
          <span class="md-nav__icon md-icon"></span>
          HTTP & OASIS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../run-frontier-squid-container/" class="md-nav__link">
        Running Frontier Squid in a Container
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../frontier-squid/" class="md-nav__link">
        Install Frontier Squid RPM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../update-oasis/" class="md-nav__link">
        Update OASIS Shared Repo
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../external-oasis-repos/" class="md-nav__link">
        Install an OASIS Repo
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_2_2" type="checkbox" id="__nav_7_2_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_2_2">
          XRootD
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="XRootD" data-md-level="3">
        <label class="md-nav__title" for="__nav_7_2_2">
          <span class="md-nav__icon md-icon"></span>
          XRootD
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../xrootd/overview/" class="md-nav__link">
        XRootD Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../xrootd/install-standalone/" class="md-nav__link">
        Install XRootD Standalone
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../xrootd/install-storage-element/" class="md-nav__link">
        Install XRootD SE
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../xrootd/xrootd-authorization/" class="md-nav__link">
        Configure Authorization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../xrootd/install-client/" class="md-nav__link">
        Using XRootD
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../xrootd/install-cms-xcache/" class="md-nav__link">
        Install CMS XCache
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../xrootd/install-shoveler/" class="md-nav__link">
        Install XRootD Shoveler
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_3" type="checkbox" id="__nav_7_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_3">
          Other
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Other" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_3">
          <span class="md-nav__icon md-icon"></span>
          Other
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../other/configuration-with-osg-configure/" class="md-nav__link">
        Configuration with OSG-Configure
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../other/install-gwms-frontend/" class="md-nav__link">
        Install GlideinWMS Frontend
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../other/install-cvmfs-stratum1/" class="md-nav__link">
        Install a CVMFS Stratum 1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../other/troubleshooting-gratia/" class="md-nav__link">
        Troubleshooting Gratia
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../other/schedd-filebeats/" class="md-nav__link">
        Install Transfer Log Filebeats
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../other/osg-token-renewer/" class="md-nav__link">
        Install OSG Token Renewal Service
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          Access Point
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Access Point" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Access Point
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../submit/install-ospool-ap/" class="md-nav__link">
        Install an OSPool Access Point
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../submit/ap-ospool-aup/" class="md-nav__link">
        Acceptable Use Policy
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_9">
          Data Federation (OSDF)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Data Federation (OSDF)" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Data Federation (OSDF)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_2" type="checkbox" id="__nav_9_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_9_2">
          Data Cache
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Data Cache" data-md-level="2">
        <label class="md-nav__title" for="__nav_9_2">
          <span class="md-nav__icon md-icon"></span>
          Data Cache
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Install from container
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Install from container
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#before-starting" class="md-nav__link">
    Before Starting
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#registering-the-cache" class="md-nav__link">
    Registering the Cache
  </a>
  
    <nav class="md-nav" aria-label="Registering the Cache">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#initial-registration" class="md-nav__link">
    Initial registration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-the-osdf-cache" class="md-nav__link">
    Configuring the OSDF Cache
  </a>
  
    <nav class="md-nav" aria-label="Configuring the OSDF Cache">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#providing-a-host-certificate" class="md-nav__link">
    Providing a host certificate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-configuration" class="md-nav__link">
    Optional configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-a-cache" class="md-nav__link">
    Running a Cache
  </a>
  
    <nav class="md-nav" aria-label="Running a Cache">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#multiple-host-partitions-recommended" class="md-nav__link">
    Multiple host partitions (recommended)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#single-host-partition" class="md-nav__link">
    Single host partition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-a-cache-on-container-with-systemd" class="md-nav__link">
    Running a cache on container with systemd
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network-optimization" class="md-nav__link">
    Network optimization
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-optimization" class="md-nav__link">
    Memory optimization
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validating-the-cache" class="md-nav__link">
    Validating the Cache
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-help" class="md-nav__link">
    Getting Help
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install-cache/" class="md-nav__link">
        Install from RPM
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9_3" type="checkbox" id="__nav_9_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_9_3">
          Data Origin
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Data Origin" data-md-level="2">
        <label class="md-nav__title" for="__nav_9_3">
          <span class="md-nav__icon md-icon"></span>
          Data Origin
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../run-stash-origin-container/" class="md-nav__link">
        Install from container
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install-origin/" class="md-nav__link">
        Install from RPM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../vo-data/" class="md-nav__link">
        Publishing VO data
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10" type="checkbox" id="__nav_10" >
      
      
      
      
        <label class="md-nav__link" for="__nav_10">
          Releases
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Releases" data-md-level="1">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          Releases
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../release/release_series/" class="md-nav__link">
        Release Series
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10_2" type="checkbox" id="__nav_10_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_10_2">
          OSG 23
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="OSG 23" data-md-level="2">
        <label class="md-nav__title" for="__nav_10_2">
          <span class="md-nav__icon md-icon"></span>
          OSG 23
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../release/osg-23/" class="md-nav__link">
        News
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../release/updating-to-osg-23/" class="md-nav__link">
        Updating to OSG 23
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10_3" type="checkbox" id="__nav_10_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_10_3">
          OSG 3.6
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="OSG 3.6" data-md-level="2">
        <label class="md-nav__title" for="__nav_10_3">
          <span class="md-nav__icon md-icon"></span>
          OSG 3.6
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../release/osg-36/" class="md-nav__link">
        News
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../release/updating-to-osg-36/" class="md-nav__link">
        Updating to OSG 3.6
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../release/supported_platforms/" class="md-nav__link">
        Supported Platforms
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../common/yum/" class="md-nav__link">
        OSG Yum Repos
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../release/yum-basics/" class="md-nav__link">
        Yum Basics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../release/signing/" class="md-nav__link">
        RPM Signing
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_11" type="checkbox" id="__nav_11" >
      
      
      
      
        <label class="md-nav__link" for="__nav_11">
          Tokens
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tokens" data-md-level="1">
        <label class="md-nav__title" for="__nav_11">
          <span class="md-nav__icon md-icon"></span>
          Tokens
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/tokens/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/tokens/using-tokens/" class="md-nav__link">
        Using Tokens
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_12" type="checkbox" id="__nav_12" >
      
      
      
      
        <label class="md-nav__link" for="__nav_12">
          CA Certificates
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="CA Certificates" data-md-level="1">
        <label class="md-nav__title" for="__nav_12">
          <span class="md-nav__icon md-icon"></span>
          CA Certificates
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../common/ca/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/certificate-management/" class="md-nav__link">
        Certificate Management Reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_12_3" type="checkbox" id="__nav_12_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_12_3">
          Host Certificates
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Host Certificates" data-md-level="2">
        <label class="md-nav__title" for="__nav_12_3">
          <span class="md-nav__icon md-icon"></span>
          Host Certificates
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/host-certs/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/host-certs/incommon/" class="md-nav__link">
        Using InCommon
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/host-certs/lets-encrypt/" class="md-nav__link">
        Using Let's Encrypt
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#before-starting" class="md-nav__link">
    Before Starting
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#registering-the-cache" class="md-nav__link">
    Registering the Cache
  </a>
  
    <nav class="md-nav" aria-label="Registering the Cache">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#initial-registration" class="md-nav__link">
    Initial registration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-the-osdf-cache" class="md-nav__link">
    Configuring the OSDF Cache
  </a>
  
    <nav class="md-nav" aria-label="Configuring the OSDF Cache">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#providing-a-host-certificate" class="md-nav__link">
    Providing a host certificate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-configuration" class="md-nav__link">
    Optional configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-a-cache" class="md-nav__link">
    Running a Cache
  </a>
  
    <nav class="md-nav" aria-label="Running a Cache">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#multiple-host-partitions-recommended" class="md-nav__link">
    Multiple host partitions (recommended)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#single-host-partition" class="md-nav__link">
    Single host partition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-a-cache-on-container-with-systemd" class="md-nav__link">
    Running a cache on container with systemd
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network-optimization" class="md-nav__link">
    Network optimization
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-optimization" class="md-nav__link">
    Memory optimization
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validating-the-cache" class="md-nav__link">
    Validating the Cache
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-help" class="md-nav__link">
    Getting Help
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/osg-htc/docs/edit/master/docs/data/stashcache/run-stashcache-container.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>



<h1 id="running-osdf-cache-in-a-container">Running OSDF Cache in a Container<a class="headerlink" href="#running-osdf-cache-in-a-container" title="Permanent link">&para;</a></h1>
<p>The OSG operates the <a href="../overview/">Open Science Data Federation</a> (OSDF), which
provides organizations with a method to distribute their data in a scalable manner to thousands of jobs without needing
to pre-stage data across sites or operate their own scalable infrastructure.</p>
<p><a href="../install-cache/">OSDF Caches</a> transfer data to clients such as jobs or users.
A set of caches are operated across the OSG for the benefit of nearby sites;
in addition, each site may run its own cache in order to reduce the amount of data transferred over the WAN.
This document outlines how to run a cache in a Docker container.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The OSDF cache was previously named "Stash Cache" and some documentation and software may use the old name.</p>
</div>
<h2 id="before-starting">Before Starting<a class="headerlink" href="#before-starting" title="Permanent link">&para;</a></h2>
<p>Before starting the installation process, consider the following requirements:</p>
<ol>
<li><strong>Docker:</strong> For the purpose of this guide, the host must have a running docker service
   and you must have the ability to start containers (i.e., belong to the <code>docker</code> Unix group).</li>
<li><strong>Network ports:</strong> The cache service requires the following open ports:<ul>
<li>Inbound TCP port 1094 for unauthenticated file access via the XRootD protocol (optional)</li>
<li>Inbound TCP port 8000 for unauthenticated file access via HTTP(S) and/or</li>
<li>Inbound TCP port 8443 for authenticated file access via HTTPS</li>
<li>Outbound UDP port 9930 for reporting to <code>xrd-report.osgstorage.org</code> and <code>xrd-mon.osgstorage.org</code> for monitoring</li>
</ul>
</li>
<li><strong>File Systems:</strong> The cache needs host partitions to store user data.
   For improved performance and storage, we recommend multiple partitions for handling namespaces (HDD, SSD, or NVMe),
   data (HDDs), and metadata (SSDs or NVMe).</li>
<li><strong>Host certificate:</strong> Required for authentication.
   See our <a href="../../../security/host-certs/">host certificate documentation</a> for instructions on how to request host certificates.</li>
<li><strong>Hardware requirements:</strong> We recommend that a cache has at least 10Gbps connectivity,
   1 TB of disk space for the cache directory, and 12GB of RAM.</li>
</ol>
<!-- NOTE: Keep the "Registering the Cache" section below in sync with install-cache.md -->

<h2 id="registering-the-cache">Registering the Cache<a class="headerlink" href="#registering-the-cache" title="Permanent link">&para;</a></h2>
<p>To be part of the OSDF, your cache must be registered with the OSG.
You will need basic information like the resource name, hostname,
host certificate DN, and the administrative and security contacts.</p>
<h3 id="initial-registration">Initial registration<a class="headerlink" href="#initial-registration" title="Permanent link">&para;</a></h3>
<p>To register your cache host, follow the general registration instructions <a href="https://osg-htc.org/docs/common/registration/#new-resources">here</a>.
The service type is <code>XRootD cache server</code>.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>This step must be completed before installation.</p>
</div>
<p>In your registration, you must specify which VOs your cache will serve by adding an <code>AllowedVOs</code> list, with each line specifying a VO whose data you are willing to cache.</p>
<p>There are special values you may use in <code>AllowedVOs</code>:</p>
<ul>
<li><code>ANY_PUBLIC</code> indicates that the cache is willing to serve public data from any VO.</li>
<li><code>ANY</code> indicates that the cache is willing to serve data from any VO,
  both public and protected.
  <code>ANY</code> implies <code>ANY_PUBLIC</code>.</li>
</ul>
<p>There are extra requirements for serving protected data:</p>
<ul>
<li>In addition to the cache allowing a VO in the <code>AllowedVOs</code> list,
  that VO must also allow the cache in its <code>AllowedCaches</code> list.
  See the page on <a href="../vo-data/">getting your VO's data into OSDF</a>.</li>
<li>There must be an authenticated XRootD instance on the cache server.</li>
<li>There must be a <code>DN</code> attribute in the resource registration
  with the <a href="../../../security/host-certs/overview/#before-starting">subject DN</a> of the host certificate</li>
</ul>
<p>This is an example registration for a cache server that serves all public data:
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="nt">MY_OSDF_CACHE</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">FQDN</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-cache.example.net</span><span class="w"></span>
<span class="w">    </span><span class="nt">Services</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">XRootD cache server</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">Description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OSDF cache server</span><span class="w"></span>
<span class="w">    </span><span class="nt">AllowedVOs</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ANY_PUBLIC</span><span class="w"></span>
</code></pre></div></p>
<p>This is an example registration for a cache server that only serves protected data for the Open Science Pool:
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="nt">MY_AUTH_OSDF_CACHE</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">FQDN</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-auth-cache.example.net</span><span class="w"></span>
<span class="w">    </span><span class="nt">Services</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">XRootD cache server</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">Description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OSDF cache server</span><span class="w"></span>
<span class="w">    </span><span class="nt">AllowedVOs</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OSG</span><span class="w"></span>
<span class="w">    </span><span class="nt">DN</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/DC=org/DC=opensciencegrid/O=Open Science Grid/OU=Services/CN=my-auth-cache.example.net</span><span class="w"></span>
</code></pre></div></p>
<p>This is an example registration for a cache server that serves all public data <em>and</em> protected data from the OSG VO:
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="nt">MY_COMBO_OSDF_CACHE</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">FQDN</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-combo-cache.example.net</span><span class="w"></span>
<span class="w">    </span><span class="nt">Services</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">XRootD cache server</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">Description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OSDF cache server</span><span class="w"></span>
<span class="w">    </span><span class="nt">AllowedVOs</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OSG</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ANY_PUBLIC</span><span class="w"></span>
<span class="w">    </span><span class="nt">DN</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/DC=org/DC=opensciencegrid/O=Open Science Grid/OU=Services/CN=my-combo-cache.example.net</span><span class="w"></span>
</code></pre></div></p>
<!-- NOTE: Keep the "Registering the Cache" section above in sync with install-cache.md -->

<h2 id="configuring-the-osdf-cache">Configuring the OSDF Cache<a class="headerlink" href="#configuring-the-osdf-cache" title="Permanent link">&para;</a></h2>
<p>In addition to the required configuration above (ports and file systems),
you may also configure the behavior of your cache with the following variables using an environment variable file:</p>
<p>Where the environment file on the docker host, <code>/opt/xcache/.env</code>, has (at least) the following contents,
replacing <code>&lt;YOUR_RESOURCE_NAME&gt;</code> with the name of your resource as
<a href="../install-cache/#registering-the-cache">registered in Topology</a>
and <code>&lt;FQDN&gt;</code> with the public DNS name that should be used to contact your cache:</p>
<div class="highlight"><pre><span></span><code>XC_RESOURCENAME=&lt;YOUR_RESOURCE_NAME&gt;
CACHE_FQDN=&lt;FQDN&gt;
</code></pre></div>
<h3 id="providing-a-host-certificate">Providing a host certificate<a class="headerlink" href="#providing-a-host-certificate" title="Permanent link">&para;</a></h3>
<p>The service will need a certificate for contacting central OSDF services
and for authenticating to origins.</p>
<p>Follow our <a href="../../../security/host-certs/">host certificate documentation</a> to obtain a host certificate and key.
Then, volume-mount the host certificate to <code>/etc/grid-security/hostcert.pem</code>,
and the key to <code>/etc/grid-security/hostkey.pem</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You must restart the container whenever you renew your certificate
in order for the services to pick up the new certificate.
If you automate certificate renewal, you should automate restarts as well.
For example, if you are using Certbot for Let's Encrypt, you should write a "deploy hook" as documented
<a href="https://certbot.eff.org/docs/using.html#renewing-certificates">on the Certbot site</a>.</p>
</div>
<h3 id="optional-configuration">Optional configuration<a class="headerlink" href="#optional-configuration" title="Permanent link">&para;</a></h3>
<p>Further behavior of the cache can be configured by setting the following in the environment variable file:</p>
<ul>
<li><code>XC_SPACE_HIGH_WM</code>, <code>XC_SPACE_LOW_WM</code>: High-water and low-water marks for disk usage,
  as numbers between 0.00 (0%) and 1.00 (100%);
  when usage goes above the high-water mark, the cache will delete files until it hits the low-water mark.</li>
<li><code>XC_RAMSIZE</code>: Amount of memory to use for storing blocks before writting them to disk. (Use higher for slower disks).</li>
<li><code>XC_BLOCKSIZE</code>: Size of the blocks in the cache.</li>
<li><code>XC_PREFETCH</code>: Number of blocks to prefetch from a file at once.
       This controls how aggressive the cache is to request portions of a file.</li>
</ul>
<h2 id="running-a-cache">Running a Cache<a class="headerlink" href="#running-a-cache" title="Permanent link">&para;</a></h2>
<p>Cache containers may be run with either multiple mounted host partitions (recommended) or a single host
partition.</p>
<p>It is recommended to use a container orchestration service such as <a href="https://docs.docker.com/compose/">docker-compose</a>
or <a href="https://kubernetes.io/">kubernetes</a> whose details are beyond the scope of this document.
The following sections provide examples for starting cache containers from the command-line as well as a more
production-appropriate method using systemd.</p>
<h3 id="multiple-host-partitions-recommended">Multiple host partitions (recommended)<a class="headerlink" href="#multiple-host-partitions-recommended" title="Permanent link">&para;</a></h3>
<p>For improved performance and storage,
especially if your cache is serving over 10 TB of data,
we recommend multiple partitions for handling namespaces (HDD, SSD, or NVMe), data (HDDs), and metadata (SSDs or NVMe).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Under this configuration the <code>&lt;NAMESPACE PARTITION&gt;</code> is not used to store the files.
Instead, the partition stores symlinks to the files in the metadata and data partitions.</p>
</div>
<div class="highlight"><pre><span></span><code><span class="gp">user@host $ </span>docker run --rm <span class="se">\</span>
             --publish &lt;HTTP HOST PORT&gt;:8000 <span class="se">\</span>
             --publish &lt;HTTPS HOST PORT&gt;:8443 <span class="se">\</span>
             --volume &lt;HOST CERT&gt;:/etc/grid-security/hostcert.pem <span class="se">\</span>
             --volume &lt;HOST KEY&gt;:/etc/grid-security/hostkey.pem <span class="se">\</span>
             --volume &lt;NAMESPACE PARTITION&gt;:/xcache/namespace <span class="se">\</span>
             --volume &lt;METADATA PARTITION <span class="m">1</span>&gt;:/xcache/meta1
<span class="go">             ...</span>
<span class="go">             --volume &lt;METADATA PARTITION N&gt;:/xcache/metaN</span>
<span class="go">             --volume &lt;DATA PARTITION 1&gt;:/xcache/data1</span>
<span class="go">             ...</span>
<span class="go">             --volume &lt;DATA PARTITION N&gt;:/xcache/dataN</span>
<span class="go">             --env-file=/opt/xcache/.env \</span>
<span class="go">             opensciencegrid/stash-cache:23-release</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>For over 10 TB of assigned space we highly encourage to use this setup and mount <code>&lt;NAMESPACE PARTITION&gt;</code> in
solid state disks or NVMe.</p>
</div>
<h3 id="single-host-partition">Single host partition<a class="headerlink" href="#single-host-partition" title="Permanent link">&para;</a></h3>
<p>For a simpler installation, you may use a single host partition mounted to <code>/xcache/</code>:</p>
<div class="highlight"><pre><span></span><code><span class="gp">user@host $ </span>docker run --rm <span class="se">\</span>
             --publish &lt;HTTP HOST PORT&gt;:8000 <span class="se">\</span>
             --publish &lt;HTTPS HOST PORT&gt;:8443 <span class="se">\</span>
             --volume &lt;HOST PARTITION&gt;:/xcache <span class="se">\</span>
             --volume &lt;HOST CERT&gt;:/etc/grid-security/hostcert.pem <span class="se">\</span>
             --volume &lt;HOST KEY&gt;:/etc/grid-security/hostkey.pem <span class="se">\</span>
             --env-file<span class="o">=</span>/opt/xcache/.env <span class="se">\</span>
             opensciencegrid/stash-cache:23-release
</code></pre></div>
<h3 id="running-a-cache-on-container-with-systemd">Running a cache on container with systemd<a class="headerlink" href="#running-a-cache-on-container-with-systemd" title="Permanent link">&para;</a></h3>
<p>An example systemd service file for the OSDF cache.
This will require creating the environment file in the directory <code>/opt/xcache/.env</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This example systemd file assumes <code>&lt;HTTP HOST PORT&gt;</code> is <code>8000</code>, <code>&lt;HTTPS HOST PORT&gt;</code> is <code>8443</code>, 
<code>&lt;HOST PARTITION&gt;</code> is <code>/srv/cache</code>, and the cert and key to use are in <code>/etc/ssl/host.crt</code> and <code>/etc/ssl/host.key</code>,
respectively.</p>
</div>
<p>Create the systemd service file <code>/etc/systemd/system/docker.stash-cache.service</code> as follows:</p>
<div class="highlight"><pre><span></span><code>[Unit]
Description=Cache Container
After=docker.service
Requires=docker.service

[Service]
TimeoutStartSec=0
Restart=always
ExecStartPre=-/usr/bin/docker stop %n
ExecStartPre=-/usr/bin/docker rm %n
ExecStartPre=/usr/bin/docker pull opensciencegrid/stash-cache:23-release
ExecStart=/usr/bin/docker run --rm --name %n \
  --publish 8000:8000 \
  --publish 8443:8443 \
  --volume /srv/cache:/xcache \
  --volume /etc/ssl/host.crt:/etc/grid-security/hostcert.pem \
  --volume /etc/ssl/host.key:/etc/grid-security/hostkey.pem \
  --env-file /opt/xcache/.env \
  opensciencegrid/stash-cache:23-release

[Install]
WantedBy=multi-user.target
</code></pre></div>
<p>Enable and start the service with:</p>
<div class="highlight"><pre><span></span><code><span class="gp">root@host $ </span>systemctl <span class="nb">enable</span> docker.stash-cache
<span class="gp">root@host $ </span>systemctl start docker.stash-cache
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>You must <a href="../install-cache/#registering-the-cache">register</a> the cache before starting it up.</p>
</div>
<h3 id="network-optimization">Network optimization<a class="headerlink" href="#network-optimization" title="Permanent link">&para;</a></h3>
<p>For caches that are connected to NICs over 40 Gbps we recommend that you disable the virtualized network and "bind" the
container to the host network:</p>
<div class="highlight"><pre><span></span><code><span class="gp">user@host $ </span>docker run --rm  <span class="se">\</span>
             --network<span class="o">=</span><span class="s2">&quot;host&quot;</span> <span class="se">\</span>
             --volume &lt;HOST PARTITION&gt;:/cache <span class="se">\</span>
             --volume &lt;HOST CERT&gt;:/etc/grid-security/hostcert.pem <span class="se">\</span>
             --volume &lt;HOST KEY&gt;:/etc/grid-security/hostkey.pem <span class="se">\</span>
             --env-file<span class="o">=</span>/opt/xcache/.env <span class="se">\</span>
             opensciencegrid/stash-cache:23-release
</code></pre></div>
<h3 id="memory-optimization">Memory optimization<a class="headerlink" href="#memory-optimization" title="Permanent link">&para;</a></h3>
<p>The cache uses the host's memory for two purposes:</p>
<ol>
<li>Caching files recently read from disk (via the kernel page cache).</li>
<li>Buffering files recently received from the network before writing them to disk (to compensate for slow disks).</li>
</ol>
<p>An easy way to increase the performance of the cache is to assign it more memory.
If you set a limit on the container's memory usage via the docker option <code>--memory</code> or Kubernetes resource limits,
make sure it is at least twice the value of <code>XC_RAMSIZE</code>.</p>
<h2 id="validating-the-cache">Validating the Cache<a class="headerlink" href="#validating-the-cache" title="Permanent link">&para;</a></h2>
<p>The cache server functions as a normal HTTP server and can interact with typical HTTP clients, such as <code>curl</code>.
Here, <code>&lt;HTTP HOST PORT&gt;</code> is the port chosen in the <code>docker run</code> command, <code>8000</code> by default.</p>
<div class="highlight"><pre><span></span><code><span class="gp">user@host $ </span>curl -O http://cache_host:&lt;HTTP HOST PORT&gt;/osgconnect/public/rynge/test.data
</code></pre></div>
<p><code>curl</code> may not correctly report a failure, so verify that the contents of the file are:
<div class="highlight"><pre><span></span><code>hello world!
</code></pre></div></p>
<h2 id="getting-help">Getting Help<a class="headerlink" href="#getting-help" title="Permanent link">&para;</a></h2>
<p>To get assistance, please use the <a href="../../../common/help/">this page</a>.</p>

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../overview/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Overview" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Overview
            </div>
          </div>
        </a>
      
      
        
        <a href="../install-cache/" class="md-footer__link md-footer__link--next" aria-label="Next: Install from RPM" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Install from RPM
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div>
    This material is based upon work supported by the
    <a href="https://nsf.gov">National Science Foundation</a>
    under Grant Nos.
    <a href="https://www.nsf.gov/awardsearch/showAward?AWD_ID=1148698">1148698</a>
    ,
    <a href="https://www.nsf.gov/awardsearch/showAward?AWD_ID=1836650">1836650</a>
    , and
    <a href="https://www.nsf.gov/awardsearch/showAward?AWD_ID=2030508">2030508</a>
    . Any opinions, findings, and conclusions or recommendations expressed in this material are those of the author(s) and do not necessarily reflect the views of the National Science Foundation.
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
        Material for MkDocs
    </a>
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.sections", "navigation.top"], "search": "../../../assets/javascripts/workers/search.5e67fbfe.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.c44cc438.min.js"></script>
      
    
  </body>
</html>