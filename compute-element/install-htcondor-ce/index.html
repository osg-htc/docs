<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Install Guide - OSG Documentation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  <link href="../../css/extra.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Install Guide";
    var mkdocs_page_input_path = "compute-element/install-htcondor-ce.md";
    var mkdocs_page_url = "/compute-element/install-htcondor-ce/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> OSG Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../install-overview/">Installation Overview</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Install Guides - Common</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../common/yum/">Yum Repos</a>
                </li>
                <li class="">
                    
    <a class="" href="../../common/ca/">CA Certificates</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Install Guides - Compute</span>
    <ul class="subnav">
                <li class=" current">
                    
    <span class="caption-text">HTCondor-CE</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../htcondor-ce-overview/">Overview</a>
                </li>
                <li class="toctree-l3 current">
                    
    <a class="current" href="./">Install Guide</a>
    <ul class="subnav">
            
    <li class="toctree-l4"><a href="#installing-and-maintaining-htcondor-ce">Installing and Maintaining HTCondor-CE</a></li>
    
        <ul>
        
            <li><a class="toctree-l5" href="#about-this-guide">About This Guide</a></li>
        
            <li><a class="toctree-l5" href="#before-starting">Before Starting</a></li>
        
            <li><a class="toctree-l5" href="#installing-htcondor-ce">Installing HTCondor-CE</a></li>
        
            <li><a class="toctree-l5" href="#configuring-htcondor-ce">Configuring HTCondor-CE</a></li>
        
            <li><a class="toctree-l5" href="#using-htcondor-ce">Using HTCondor-CE</a></li>
        
            <li><a class="toctree-l5" href="#validating-htcondor-ce">Validating HTCondor-CE</a></li>
        
            <li><a class="toctree-l5" href="#troubleshooting-htcondor-ce">Troubleshooting HTCondor-CE</a></li>
        
            <li><a class="toctree-l5" href="#registering-the-ce">Registering the CE</a></li>
        
            <li><a class="toctree-l5" href="#getting-help">Getting Help</a></li>
        
            <li><a class="toctree-l5" href="#reference">Reference</a></li>
        
        </ul>
    

    </ul>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../../other/gsissh/">GSI-enabled SSH</a>
                </li>
                <li class="">
                    
    <a class="" href="../../client/cvmfs/">CVMFS</a>
                </li>
                <li class="">
                    
    <a class="" href="../../client/wn/">Worker Node (RPM install)</a>
                </li>
                <li class="">
                    
    <a class="" href="../../client/wn-tarball/">Worker Node (tarball install)</a>
                </li>
                <li class="">
                    
    <a class="" href="../../client/wn-oasis/">Worker Node (OASIS install)</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Install Guides - Data</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../frontier-squid/squid/">HTTP Cache</a>
                </li>
                <li class="">
                    
    <a class="" href="../../storage/gridftp/">GridFTP Server</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Release Information</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../release/release_series/">OSG Release Series</a>
                </li>
                <li class="">
                    
    <a class="" href="../../release/yum-basics/">Yum Basics</a>
                </li>
                <li class="">
                    
    <a class="" href="../../release/signing/">RPM Signing</a>
                </li>
                <li class="">
                    
    <a class="" href="../../release/supported_platforms/">Supported Platforms</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Usage Guides</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../common/pki-cli/">Certificate Tools</a>
                </li>
                <li class="">
                    
    <a class="" href="../../client/using-wn/">Worker Node Environment</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">In-Progress Docs</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../common/ca_updater/">CA Updater</a>
                </li>
                <li class="">
                    
    <a class="" href="../../common/cert_scripts/">Certificate Request Scripts</a>
                </li>
                <li class="">
                    
    <a class="" href="../job_router/">Job Router Recipe</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Deprecated Software</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../storage/bestman-overview/">BeStMan Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../../storage/bestman-install/">BeStMan Install</a>
                </li>
                <li class="">
                    
    <a class="" href="../../client/glexec/">Worker node glexec</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../common/help/">Get Help</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">OSG Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Install Guides - Compute &raquo;</li>
        
      
        
          <li>HTCondor-CE &raquo;</li>
        
      
    
    <li>Install Guide</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/opensciencegrid/docs/edit/master/docs/compute-element/install-htcondor-ce.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="installing-and-maintaining-htcondor-ce">Installing and Maintaining HTCondor-CE</h1>
<h2 id="about-this-guide">About This Guide</h2>
<p>The <a href="../htcondor-ce-overview">HTCondor-CE</a> software is a <em>job gateway</em> for an OSG Compute Element (CE). As such, HTCondor-CE is the entry point for jobs coming from the OSG — it handles authorization and delegation of jobs to your local batch system. In OSG today, most CEs accept <em>pilot jobs</em> from a factory, which in turn are able to accept and run end-user jobs.</p>
<p>Use this page to learn how to install, configure, run, test, and troubleshoot HTCondor-CE from the OSG software repositories.</p>
<h2 id="before-starting">Before Starting</h2>
<p>Before starting the installation process, consider the following points (consulting <a href="#reference">the Reference section below</a> as needed):</p>
<ul>
<li><strong>User IDs:</strong> If they do not exist already, the installation will create the Linux users <code>condor</code> (UID 4716) and <code>gratia</code> (UID 42401)</li>
<li><strong>Service certificate:</strong> The HTCondor-CE service uses a host certificate at <code>/etc/grid-security/hostcert.pem</code> and an accompanying key at <code>/etc/grid-security/hostkey.pem</code></li>
<li><strong>Network ports:</strong> The pilot factories must be able to contact your HTCondor-CE service on ports 9619 and 9620 for condor versions &lt; 8.3.2 (TCP)</li>
<li><strong>Host choice:</strong> HTCondor-CE should be installed on a host that already has the ability to submit jobs into your local cluster</li>
</ul>
<p>As with all OSG software installations, there are some one-time (per host) steps to prepare in advance:</p>
<ul>
<li>Ensure the host has <a href="../../release/supported_platforms">a supported operating system</a></li>
<li>Obtain root access to the host</li>
<li>Prepare the <a href="../../common/yum">required Yum repositories</a></li>
<li>Install <a href="https://twiki.grid.iu.edu/bin/view/Documentation/Release3/InstallCertAuth">CA certificates</a></li>
</ul>
<h2 id="installing-htcondor-ce">Installing HTCondor-CE</h2>
<p>An HTCondor-CE installation consists of the job gateway (i.e., the HTCondor-CE job router) and other support software (e.g., GridFTP, a Gratia probe, authentication software). To simplify installation, OSG provides convenience RPMs that install all required software with a single command.</p>
<ol>
<li>
<p>Clean yum cache:</p>
<div class="codehilite"><pre><span></span><span class="gp">[root@client ~ ] $</span> yum clean all --enablerepo<span class="o">=</span>*
</pre></div>


</li>
<li>
<p>Update software:</p>
<div class="codehilite"><pre><span></span><span class="gp">[root@client ~ ] $</span> yum update
</pre></div>


<p>This command will update <strong>all</strong> packages</p>
</li>
<li>
<p>If your batch system is already installed via non-RPM means and is in the following list, install the appropriate 'empty' RPM. Otherwise, skip to the next step.</p>
<table>
<thead>
<tr>
<th align="left">If your batch system is…</th>
<th align="left">Then run the following command…</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">HTCondor</td>
<td align="left"><code>yum install empty-condor --enablerepo=osg-empty</code></td>
</tr>
<tr>
<td align="left">PBS</td>
<td align="left"><code>yum install empty-torque --enablerepo=osg-empty</code></td>
</tr>
<tr>
<td align="left">SGE</td>
<td align="left"><code>yum install empty-gridengine --enablerepo=osg-empty</code></td>
</tr>
<tr>
<td align="left">SLURM</td>
<td align="left"><code>yum install empty-slurm --enablerepo=osg-empty</code></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>If your HTCondor batch system is already installed via non-OSG RPM means, add the line below to <code>/etc/yum.repos.d/osg.repo</code>. Otherwise, skip to the next step.</p>
<div class="codehilite"><pre><span></span>exclude=condor empty-condor
</pre></div>


</li>
<li>
<p>Select the appropriate convenience RPM(s):</p>
<table>
<thead>
<tr>
<th align="left">If your batch system is…</th>
<th align="left">Then use the following package(s)…</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">HTCondor</td>
<td align="left"><code>osg-ce-condor</code></td>
</tr>
<tr>
<td align="left">LSF</td>
<td align="left"><code>osg-ce-lsf</code></td>
</tr>
<tr>
<td align="left">PBS</td>
<td align="left"><code>osg-ce-pbs</code></td>
</tr>
<tr>
<td align="left">SGE</td>
<td align="left"><code>osg-ce-sge</code></td>
</tr>
<tr>
<td align="left">SLURM</td>
<td align="left"><code>osg-ce-slurm</code></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Install the CE software:</p>
<div class="codehilite"><pre><span></span>[root@client ~] $ yum install *PACKAGE(S)*
</pre></div>


</li>
</ol>
<h2 id="configuring-htcondor-ce">Configuring HTCondor-CE</h2>
<p>There are a few required configuration steps to connect HTCondor-CE with your batch system and authentication method. For more advanced configuration, see the section on <a href="#optional-configuration">optional configurations</a>.</p>
<h3 id="enabling-htcondor-ce">Enabling HTCondor-CE</h3>
<p>If you are installing HTCondor-CE on a new host, the default configuration is correct and you can skip this step and continue onto <a href="#configuring-the-batch-system">Configuring the batch system</a>! However, if you are updating a host that used a Globus GRAM job gateway (aka the Globus gatekeeper), you must disable GRAM and enable the HTCondor job gateway. Edit the gateway configuration file <code>/etc/osg/config.d/10-gateway.ini</code> so that it reads:</p>
<div class="codehilite"><pre><span></span>gram_gateway_enabled = False
htcondor_gateway_enabled = True
</pre></div>


<h3 id="configuring-the-batch-system">Configuring the batch system</h3>
<p>Enable your batch system by editing the <code>enabled</code> field in the <code>/etc/osg/config.d/20-&lt;YOUR BATCH SYSTEM&gt;.ini</code></p>
<div class="codehilite"><pre><span></span>enabled = <span style="color:red">True</span>
</pre></div>


<p>If you are using HTCondor as your <strong>local batch system</strong> (i.e., in addition to your HTCondor-CE), skip to the <a href="#configuring-authentication">configuring authentication</a> section. For other batch systems (e.g., PBS, LSF, SGE, SLURM), keep reading.</p>
<h4 id="batch-systems-other-than-htcondor">Batch systems other than HTCondor</h4>
<p>Non-HTCondor batch systems require additional configuration to support file transfer to your site's worker nodes.</p>
<h5 id="sharing-the-spool-directory">Sharing the spool directory</h5>
<p>To transfer files between the CE and the batch system, HTCondor-CE requires a shared file system. The current recommendation is to run a dedicated NFS server (whose installation is beyond the scope of this document) on the <strong>CE host</strong>. In this setup, HTCondor-CE writes to the local spool directory and the NFS server shares the directory with all of the worker nodes.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you choose not to host the NFS server on your CE, you will need to turn off root squash so that the HTCondor-CE daemons can write to the spool directory.</p>
</div>
<p>By default, the spool directory is <code>/var/lib/condor-ce</code> but you can control this by setting <code>SPOOL</code> in <code>/etc/condor-ce/config.d/99-local.conf</code> (create this file if it doesn't exist). For example, the following sets the <code>SPOOL</code> directory to <code>/home/condor</code>:</p>
<div class="codehilite"><pre><span></span>SPOOL=/home/condor
</pre></div>


<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The shared spool directory must be readable and writeable by the <code>condor</code> user for HTCondor-CE to function correctly.</p>
</div>
<h5 id="disable-worker-node-proxy-renewal">Disable worker node proxy renewal</h5>
<p>Worker node proxy renewal is not used by HTCondor-CE and leaving it on will cause some jobs to be held. Edit <code>/etc/blah.config</code> on the HTCondor-CE host and set the following values:</p>
<div class="codehilite"><pre><span></span>blah_disable_wn_proxy_renewal=yes
blah_delegate_renewed_proxies=no
blah_disable_limited_proxy=yes
</pre></div>


<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There should be no whitespace around the <code>=</code>.</p>
</div>
<h3 id="configuring-authentication">Configuring authentication</h3>
<p>In OSG 3.3, there are three methods to manage authentication for incoming jobs: the <a href="https://twiki.grid.iu.edu/bin/view/Documentation/Release3/InstallLcmapsVoms">LCMAPS VOMS plugin</a>, <a href="https://twiki.grid.iu.edu/bin/view/Documentation/Release3/Edg-mkgridmap">edg-mkgridmap</a> and <a href="https://twiki.grid.iu.edu/bin/view/Documentation/Release3/InstallGums">GUMS</a>. edg-mkgridmap is easy to set up and maintain, and GUMS has more features and capabilities. The LCMAPS VOMS plugin is the new OSG-preferred authentication, offering the simplicity of edg-mkgridmap and many of GUMS' rich feature set. If you need to support <a href="https://www.racf.bnl.gov/Facility/GUMS/1.4/use_configuration.html">pool accounts</a>, GUMS is the only software with that capability.</p>
<p>In OSG 3.4, the LCMAPS VOMS plugin is the only available authentication solution.</p>
<h4 id="authentication-with-the-lcmaps-voms-plugin">Authentication with the LCMAPS VOMS plugin</h4>
<p>To configure your CE to use the LCMAPS VOMS plugin:</p>
<ol>
<li>
<p>If you are using OSG 3.3, add the following line to <code>/etc/sysconfig/condor-ce</code>:</p>
<div class="codehilite"><pre><span></span>export LLGT_VOMS_ENABLE_CREDENTIAL_CHECK=1
</pre></div>


</li>
<li>
<p>Follow the instructions in <a href="https://twiki.grid.iu.edu/bin/view/Documentation/Release3/InstallLcmapsVoms">the LCMAPS VOMS plugin installation and configuration document</a> to prepare the LCMAPS VOMS plugin</p>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If your local batch system is HTCondor, it will attempt to utilize the LCMAPS callouts if enabled in the <code>condor_mapfile</code>. If this is not the desired behavior, set <code>GSI_AUTHZ_CONF=/dev/null</code> in the local HTCondor configuration.</p>
</div>
<h4 id="authentication-with-edg-mkgridmap">Authentication with edg-mkgridmap</h4>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>edg-mkgridmap is unavailable in OSG 3.4</p>
</div>
<p>To configure your CE to use edg-mkgridmap:</p>
<ol>
<li>Follow the configuration instructions in <a href="https://twiki.grid.iu.edu/bin/view/Documentation/Release3/Edg-mkgridmap">the edg-mkgridmap document</a> to define the VOs that your site accepts</li>
<li>Set some critical gridmap attributes by editing the <code>/etc/osg/config.d/10-misc.ini</code> file on the HTCondor-CE host:<div class="codehilite"><pre><span></span>authorization_method = gridmap
</pre></div>


</li>
</ol>
<h4 id="authentication-with-gums">Authentication with GUMS</h4>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>GUMS is unavailable in OSG 3.4</p>
</div>
<ol>
<li>Follow the instructions in <a href="https://twiki.grid.iu.edu/bin/view/Documentation/Release3/InstallGums">the GUMS installation and configuration document</a> to prepare GUMS</li>
<li>Set some critical GUMS attributes by editing the <code>/etc/osg/config.d/10-misc.ini</code> file on the HTCondor-CE host:<div class="codehilite"><pre><span></span>authorization_method = xacml
gums_host = <span style="color:red">YOUR GUMS HOSTNAME</span>
</pre></div>


</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If your local batch system is HTCondor, it will attempt to utilize the LCMAPS callouts if enabled in the <code>condor_mapfile</code>. If this is not the desired behavior, set <code>GSI_AUTHZ_CONF=/dev/null</code> in the local HTCondor configuration.</p>
</div>
<h3 id="configuring-ce-collector-advertising">Configuring CE collector advertising</h3>
<p>To split jobs between the various sites of the OSG, information about each site's capabilities are uploaded to a central collector. The job factories then query the central collector for idle resources and submit pilot jobs to the available sites. To advertise your site, you will need to enter some information about the worker nodes of your clusters.</p>
<p>Please see the <a href="https://twiki.grid.iu.edu/bin/view/Documentation/Release3/IniConfigurationOptions#Subcluster_Resource_Entry_Config">Subcluster / Resource Entry configuration document</a> about configuring the data that will be uploaded to the central collector.</p>
<h3 id="applying-configuration-settings">Applying configuration settings</h3>
<p>Making changes to the OSG configuration files in the <code>/etc/osg/config.d</code> directory does not apply those settings to software automatically. Settings that are made outside of the OSG directory take effect immediately or at least when the relevant service is restarted. For the OSG settings, use the <a href="https://twiki.grid.iu.edu/bin/view/Documentation/Release3/IniConfigurationOptions">osg-configure</a> tool to validate (to a limited extent) and apply the settings to the relevant software components. The <code>osg-configure</code> software is included automatically in an HTCondor-CE installation.</p>
<ol>
<li>
<p>Make all changes to <code>.ini</code> files in the <code>/etc/osg/config.d</code> directory</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This document describes the critical settings for HTCondor-CE and related software. You may need to configure other software that is installed on your HTCondor-CE host, too.</p>
</div>
</li>
<li>
<p>Validate the configuration settings</p>
<div class="codehilite"><pre><span></span><span class="gp">[root@client ~ ] $</span> osg-configure -v
</pre></div>


</li>
<li>
<p>Fix any errors (at least) that <code>osg-configure</code> reports.</p>
</li>
<li>
<p>Once the validation command succeeds without errors, apply the configuration settings:</p>
<div class="codehilite"><pre><span></span>[root@client ~ ] $ osg-configure -c
</pre></div>


</li>
<li>
<p>Generate a <code>user-vo-map</code> file with your authentication set up (skip this step if you're using the LCMAPS VOMS plugin):</p>
<ol>
<li>
<p>If you're using edg-mkgridmap, run the following:</p>
<div class="codehilite"><pre><span></span><span class="gp">[root@client ~ ] $</span> edg-mkgridmap
</pre></div>


</li>
<li>
<p>If you're using GUMS, run the following:</p>
<div class="codehilite"><pre><span></span><span class="gp">[root@client ~ ] $</span> gums-host-cron
</pre></div>


</li>
</ol>
</li>
</ol>
<h3 id="optional-configuration">Optional configuration</h3>
<p>The following configuration steps are optional and will likely not be required for setting up a small site. If you do not need any of the following special configurations, skip to <a href="#using-htcondor-ce">the section on using HTCondor-CE</a>.</p>
<ul>
<li><a href="#transforming-and-filtering-jobs">Transforming and filtering jobs</a></li>
<li><a href="#configuring-for-multiple-network-interfaces">Configuring for multiple network interfaces</a></li>
<li><a href="#limiting-or-disabling-locally-running-jobs-on-the-ce">Limiting or disabling locally running jobs on the CE</a></li>
<li><a href="#accounting-with-multiple-ces-or-local-user-jobs">Accounting with multiple CEs or local user jobs</a></li>
<li><a href="#htcondor-accounting-groups">HTCondor accounting groups</a></li>
<li><a href="#install-and-run-the-htcondor-ce-view">Installing the HTCondor-CE View</a></li>
</ul>
<h4 id="transforming-and-filtering-jobs">Transforming and filtering jobs</h4>
<p>If you need to modify or filter jobs, more information can be found in the <a href="https://twiki.opensciencegrid.org/bin/view/Documentation/Release3/JobRouterRecipes">Job Router Recipes</a> document.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you need to assign jobs to HTCondor accounting groups, refer to <a href="#htcondor-accounting-groups">this</a> section.</p>
</div>
<h4 id="configuring-for-multiple-network-interfaces">Configuring for multiple network interfaces</h4>
<p>If you have multiple network interfaces with different hostnames, the HTCondor-CE daemons need to know which hostname and interface to use when communicating to each other. Set <code>NETWORK_HOSTNAME</code> and <code>NETWORK_INTERFACE</code> to the hostname and IP address of your public interface, respectively, in <code>/etc/condor-ce/config.d/99-local.conf</code> directory with the line:</p>
<div class="codehilite"><pre><span></span>NETWORK_HOSTNAME = <span style="color:red">condorce.example.com</span>
NETWORK_INTERFACE = <span style="color:red">127.0.0.1</span>
</pre></div>


<p>Replacing <code>condorce.example.com</code> text with your public interface’s hostname and <code>127.0.0.1</code> with your public interface’s IP address.</p>
<h4 id="limiting-or-disabling-locally-running-jobs-on-the-ce">Limiting or disabling locally running jobs on the CE</h4>
<p>If you want to limit or disable jobs running locally on your CE, you will need to configure HTCondor-CE's local and scheduler universes. Local and scheduler universes are HTCondor-CE’s analogue to GRAM’s managed fork: they allow jobs to be run on the CE itself, mainly for remote troubleshooting. Pilot jobs will not run as local/scheduler universe jobs so leaving them enabled does NOT turn your CE into another worker node.</p>
<p>The two universes are effectively the same (scheduler universe launches a starter process for each job), so we will be configuring them in unison.</p>
<ul>
<li>
<p><strong>To change the default limit</strong> on the number of locally run jobs (the current default is 20), add the following to <code>/etc/condor-ce/config.d/99-local.conf</code>: </p>
<div class="codehilite"><pre><span></span><span class="nv">START_LOCAL_UNIVERSE</span> <span class="o">=</span> TotalLocalJobsRunning + TotalSchedulerJobsRunning &lt; <span style="color:red">&lt;JOB-LIMIT&gt;</span>
<span class="nv">START_SCHEDULER_UNIVERSE</span> <span class="o">=</span> <span class="k">$(</span>START_LOCAL_UNIVERSE<span class="k">)</span>
</pre></div>


</li>
<li>
<p><strong>To only allow a specific user</strong> to start locally run jobs, add the following to <code>/etc/condor-ce/config.d/99-local.conf</code>: </p>
<div class="codehilite"><pre><span></span><span class="nv">START_LOCAL_UNIVERSE</span> <span class="o">=</span> target.Owner <span class="o">=</span>?<span class="o">=</span> <span class="s2">&quot;<span style="color:red">&lt;USERNAME&gt;</span>&quot;</span>
<span class="nv">START_SCHEDULER_UNIVERSE</span> <span class="o">=</span> <span class="k">$(</span>START_LOCAL_UNIVERSE<span class="k">)</span>
</pre></div>


</li>
<li>
<p><strong>To disable</strong> locally run jobs, add the following to <code>/etc/condor-ce/config.d/99-local.conf</code>: </p>
<div class="codehilite"><pre><span></span><span class="nv">START_LOCAL_UNIVERSE</span> <span class="o">=</span> False
<span class="nv">START_SCHEDULER_UNIVERSE</span> <span class="o">=</span> <span class="k">$(</span>START_LOCAL_UNIVERSE<span class="k">)</span>
</pre></div>


</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>RSV requires the ability to start local universe jobs so if you are using RSV, you need to allow local universe jobs from the <code>rsv</code> user.</p>
</div>
<h4 id="accounting-with-multiple-ces-or-local-user-jobs">Accounting with multiple CEs or local user jobs</h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For non-HTCondor batch systems only</p>
</div>
<p>If your site has multiple CEs or you have non-grid users submitting to the same local batch system, the OSG accounting software needs to be configured so that it doesn't over report the number of jobs. Use the following table to determine which file requires editing:</p>
<table>
<thead>
<tr>
<th align="left">If your batch system is…</th>
<th align="left">Then edit the following file on your CE(s)…</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">LSF</td>
<td align="left"><code>/etc/gratia/pbs-lsf/ProbeConfig</code></td>
</tr>
<tr>
<td align="left">PBS</td>
<td align="left"><code>/etc/gratia/pbs-lsf/ProbeConfig</code></td>
</tr>
<tr>
<td align="left">SGE</td>
<td align="left"><code>/etc/gratia/sge/ProbeConfig</code></td>
</tr>
<tr>
<td align="left">SLURM</td>
<td align="left"><code>/etc/gratia/slurm/ProbeConfig</code></td>
</tr>
</tbody>
</table>
<p>Then edit the value of <code>SuppressNoDNRecords</code> so that it reads:</p>
<div class="codehilite"><pre><span></span>SuppressNoDNRecords=&quot;1&quot;
</pre></div>


<h4 id="htcondor-accounting-groups">HTCondor accounting groups</h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For HTCondor batch systems only</p>
</div>
<p>If you want to provide fairshare on a group basis, as opposed to a Unix user basis, you can use HTCondor accounting groups. They are independent of the Unix groups the user may already be in and are <a href="http://research.cs.wisc.edu/condor/manual/v8.2/3_4User_Priorities.html#SECTION00447000000000000000">documented in the HTCondor manual</a>. If you are using HTCondor accounting groups, you can map jobs from the CE into HTCondor accounting groups based on their UID, their DN, or their VOMS attributes.</p>
<ul>
<li>
<p><strong>To map UIDs to an accounting group,</strong> add entries to <code>/etc/osg/uid_table.txt</code> with the following form:</p>
<div class="codehilite"><pre><span></span>uid GroupName
</pre></div>


<p>The following is an example <code>uid_table.txt</code>:</p>
<div class="codehilite"><pre><span></span>uscms02 TestGroup
osg     other.osgedu
</pre></div>


</li>
<li>
<p><strong>To map DNs or VOMS attributes to an accounting group,</strong> add lines to <code>/etc/osg/extattr_table.txt</code> with the following form:</p>
<div class="codehilite"><pre><span></span><span class="c"><span style="color:red">SubjectOrAttribute</span> GroupName</span>
</pre></div>


<p>The <span style="color:red">SubjectOrAttribute</span> can be a Perl regular expression. The following is an example <code>extattr_table.txt</code>:</p>
<div class="codehilite"><pre><span></span>cmsprio cms.other.prio
cms\/Role=production cms.prod
\/DC=com\/DC=DigiCert-Grid\/O=Open\ Science\ Grid\/OU=People\/CN=Brian\ Lin\ 1047 osg.test
.* other
</pre></div>


</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Entries in <code>/etc/osg/uid_table.txt</code> are honored over <code>/etc/osg/extattr_table.txt</code> if a job would match to lines in both files.</p>
</div>
<h4 id="install-and-run-the-htcondor-ce-view">Install and run the HTCondor-CE View</h4>
<p>The HTCondor-CE View is an optional web interface to the status of your CE. To run the View,</p>
<ol>
<li>
<p>Begin by installing the package htcondor-ce-view:</p>
<div class="codehilite"><pre><span></span><span class="gp">[root@client ~ ] $</span> yum install htcondor-ce-view
</pre></div>


</li>
<li>
<p>Next, uncomment the <code>DAEMON_LIST</code> configuration located at <code>/etc/condor-ce/config.d/05-ce-view.conf</code>:</p>
<div class="codehilite"><pre><span></span><span class="nv">DAEMON_LIST</span> <span class="o">=</span> <span class="k">$(</span>DAEMON_LIST<span class="k">)</span>, CEVIEW, GANGLIAD
</pre></div>


</li>
<li>
<p>Restart the CE service:</p>
<div class="codehilite"><pre><span></span><span class="gp">[root@client ~ ] $</span> service condor-ce restart
</pre></div>


</li>
<li>
<p>Verify the service by entering your CE's hostname into your web browser</p>
</li>
</ol>
<p>The website is served on port 80 by default. To change this default, edit the value of <code>HTCONDORCE_VIEW_PORT</code> in <code>/etc/condor-ce/config.d/05-ce-view.conf</code>.</p>
<h2 id="using-htcondor-ce">Using HTCondor-CE</h2>
<p>As a site administrator, there are a few ways in which you might use the HTCondor-CE:</p>
<ul>
<li>Managing the HTCondor-CE and associated services</li>
<li>Using HTCondor-CE administrative tools to monitor and maintain the job gateway</li>
<li>Using HTCondor-CE user tools to test gateway operations</li>
</ul>
<h3 id="managing-htcondor-ce-and-associated-services">Managing HTCondor-CE and associated services</h3>
<p>In addition to the HTCondor-CE job gateway service itself, there are a number of supporting services in your installation. The specific services are:</p>
<table>
<thead>
<tr>
<th align="left">Software</th>
<th align="left">Service name</th>
<th align="left">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Fetch CRL</td>
<td align="left"><code>fetch-crl-boot</code> and <code>fetch-crl-cron</code></td>
<td align="left">See <a href="https://twiki.opensciencegrid.org/bin/view/Documentation/Release3/InstallCertAuth#Start_Stop_fetch_crl_A_quick_gui">CA documentation</a> for more info</td>
</tr>
<tr>
<td align="left">Gratia</td>
<td align="left"><code>gratia-probes-cron</code></td>
<td align="left">Accounting software</td>
</tr>
<tr>
<td align="left">Your batch system</td>
<td align="left"><code>condor</code> or <code>pbs_server</code> or …</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">HTCondor-CE</td>
<td align="left"><code>condor-ce</code></td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p>Start the services in the order listed and stop them in reverse order. As a reminder, here are common service commands (all run as <code>root</code>):</p>
<table>
<thead>
<tr>
<th align="left">To...</th>
<th align="left">On EL6, run the command...</th>
<th align="left">On EL7, run the command...</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Start a service</td>
<td align="left"><code>service &lt;SERVICE-NAME&gt; start</code></td>
<td align="left"><code>systemctl start &lt;SERVICE-NAME&gt;</code></td>
</tr>
<tr>
<td align="left">Stop a  service</td>
<td align="left"><code>service &lt;SERVICE-NAME&gt; stop</code></td>
<td align="left"><code>systemctl stop &lt;SERVICE-NAME&gt;</code></td>
</tr>
<tr>
<td align="left">Enable a service to start on boot</td>
<td align="left"><code>chkconfig &lt;SERVICE-NAME&gt; on</code></td>
<td align="left"><code>systemctl enable &lt;SERVICE-NAME&gt;</code></td>
</tr>
<tr>
<td align="left">Disable a service from starting on boot</td>
<td align="left"><code>chkconfig &lt;SERVICE-NAME&gt; off</code></td>
<td align="left"><code>systemctl disable &lt;SERVICE-NAME&gt;</code></td>
</tr>
</tbody>
</table>
<h3 id="using-htcondor-ce-tools">Using HTCondor-CE tools</h3>
<p>Some of the HTCondor-CE administrative and user tools are documented in <a href="https://twiki.grid.iu.edu/bin/view/Documentation/Release3/TroubleshootingHTCondorCE">the HTCondor-CE troubleshooting guide</a>.</p>
<h2 id="validating-htcondor-ce">Validating HTCondor-CE</h2>
<p>There are different ways to make sure that your HTCondor-CE host is working well:</p>
<ul>
<li>Perform automated validation by running <a href="https://twiki.grid.iu.edu/bin/view/Documentation/Release3/InstallRSV">RSV</a></li>
<li>Manually verify your HTCondor-CE using <a href="https://twiki.grid.iu.edu/bin/view/Documentation/Release3/TroubleshootingHTCondorCE">HTCondor-CE troubleshooting guide</a>; useful tools include:<ul>
<li><a href="https://twiki.grid.iu.edu/bin/view/Documentation/Release3/TroubleshootingHTCondorCE#condor_ce_run">condor_ce_run</a></li>
<li><a href="https://twiki.grid.iu.edu/bin/view/Documentation/Release3/TroubleshootingHTCondorCE#condor_ce_trace">condor_ce_trace</a></li>
<li><a href="https://twiki.grid.iu.edu/bin/view/Documentation/Release3/TroubleshootingHTCondorCE#condor_submit">condor_submit</a></li>
</ul>
</li>
</ul>
<h2 id="troubleshooting-htcondor-ce">Troubleshooting HTCondor-CE</h2>
<p>For information on how to troubleshoot your HTCondor-CE, please refer to <a href="https://twiki.grid.iu.edu/bin/view/Documentation/Release3/TroubleshootingHTCondorCE">the HTCondor-CE troubleshooting guide</a>.</p>
<h2 id="registering-the-ce">Registering the CE</h2>
<p>To be part of the OSG Production Grid, your CE must be registered in the <a href="https://oim.opensciencegrid.org">OSG Information Management System</a> (OIM). To register your resource:</p>
<ol>
<li><a href="https://twiki.opensciencegrid.org/bin/view/Documentation/Release3/CertificateUserGet">Obtain, install, and verify your user certificate</a> (which you may have done already)</li>
<li><a href="https://twiki.grid.iu.edu/bin/view/Operations/OIMRegistrationInstructions">Register your site and CE in OIM</a></li>
</ol>
<h2 id="getting-help">Getting Help</h2>
<p>To get assistance, please use the <a href="../../common/help">this page</a>.</p>
<h2 id="reference">Reference</h2>
<p>Here are some other HTCondor-CE documents that might be helpful:</p>
<ul>
<li><a href="../htcondor-ce-overview">HTCondor-CE overview and architecture</a></li>
<li><a href="https://twiki.grid.iu.edu/bin/view/Documentation/Release3/InstallHTCondorBosco">Installing and maintaining HTCondor-CE-Bosco</a></li>
<li><a href="https://twiki.grid.iu.edu/bin/view/Documentation/Release3/JobRouterRecipes">Configuring HTCondor-CE job routes</a></li>
<li><a href="https://twiki.grid.iu.edu/bin/view/Documentation/Release3/TroubleshootingHTCondorCE">The HTCondor-CE troubleshooting guide</a></li>
<li><a href="https://twiki.grid.iu.edu/bin/view/Documentation/Release3/SubmittingHTCondorCE">Submitting jobs to HTCondor-CE</a></li>
</ul>
<h3 id="configuration">Configuration</h3>
<p>The following directories contain the configuration for HTCondor-CE. The directories are parsed in the order presented and thus configuration within the final directory will override configuration specified in the previous directories.</p>
<table>
<thead>
<tr>
<th align="left">Location</th>
<th align="left">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>/usr/share/condor-ce/config.d/</code></td>
<td align="left">Configuration defaults (overwritten on package updates)</td>
</tr>
<tr>
<td align="left"><code>/etc/condor-ce/config.d/</code></td>
<td align="left">Files in this directory are parsed in alphanumeric order (i.e., <code>99-local.conf</code> will override values in <code>01-ce-auth.conf</code>)</td>
</tr>
</tbody>
</table>
<p>For a detailed order of the way configuration files are parsed, run the following command:</p>
<div class="codehilite"><pre><span></span><span class="gp">[user@client ~ ] $</span> condor_ce_config_val -config
</pre></div>


<h3 id="users">Users</h3>
<p>The following users are needed by HTCondor-CE at all sites:</p>
<table>
<thead>
<tr>
<th align="left">User</th>
<th align="left">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>condor</code></td>
<td align="left">The HTCondor-CE will be run as root, but perform most of its operations as the <code>condor</code> user.</td>
</tr>
<tr>
<td align="left"><code>gratia</code></td>
<td align="left">Runs the Gratia probes to collect accounting data</td>
</tr>
</tbody>
</table>
<h3 id="certificates">Certificates</h3>
<table>
<thead>
<tr>
<th align="left">File</th>
<th align="left">User that owns certificate</th>
<th align="left">Path to certificate</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Host certificate</td>
<td align="left"><code>root</code></td>
<td align="left"><code>/etc/grid-security/hostcert.pem</code></td>
</tr>
<tr>
<td align="left">Host key</td>
<td align="left"><code>root</code></td>
<td align="left"><code>/etc/grid-security/hostkey.pem</code></td>
</tr>
</tbody>
</table>
<p>Find instructions to request a host certificate <a href="https://twiki.grid.iu.edu/bin/view/Documentation/Release3/GetHostServiceCertificates">here</a>.</p>
<h3 id="networking">Networking</h3>
<table>
<thead>
<tr>
<th align="left">Service Name</th>
<th align="center">Protocol</th>
<th align="center">Port Number</th>
<th align="center">Inbound</th>
<th align="center">Outbound</th>
<th align="left">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Htcondor-CE</td>
<td align="center">tcp</td>
<td align="center">9619</td>
<td align="center">X</td>
<td align="center"></td>
<td align="left">HTCondor-CE shared port</td>
</tr>
</tbody>
</table>
<p>Allow inbound and outbound network connection to all internal site servers, such as GUMS and the batch system head-node only ephemeral outgoing ports are necessary.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../other/gsissh/" class="btn btn-neutral float-right" title="GSI-enabled SSH">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../htcondor-ce-overview/" class="btn btn-neutral" title="Overview"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/opensciencegrid/docs" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../htcondor-ce-overview/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../other/gsissh/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../../js/theme.js"></script>

</body>
</html>
