<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>HTTP Cache - OSG Documentation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  <link href="../../css/extra.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "HTTP Cache";
    var mkdocs_page_input_path = "frontier-squid/squid.md";
    var mkdocs_page_url = "/frontier-squid/squid/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> OSG Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../install-overview/">Installation Overview</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Install Guides</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../common/yum/">Yum Repos</a>
                </li>
                <li class="">
                    
    <a class="" href="../../common/ca/">CA Certificates</a>
                </li>
                <li class="">
                    
    <a class="" href="../../compute-element/HTCondor_CE/">HTCondor-CE</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">HTTP Cache</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#frontier-squid-caching-proxy-installation-guide">Frontier Squid Caching Proxy Installation Guide</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#about-this-document">About This Document</a></li>
        
            <li><a class="toctree-l4" href="#applicable-versions">Applicable Versions</a></li>
        
            <li><a class="toctree-l4" href="#about-frontier-squid">About Frontier Squid</a></li>
        
            <li><a class="toctree-l4" href="#frontier-squid-is-recommended">Frontier Squid is Recommended</a></li>
        
            <li><a class="toctree-l4" href="#engineering-considerations">Engineering Considerations</a></li>
        
            <li><a class="toctree-l4" href="#requirements">Requirements</a></li>
        
            <li><a class="toctree-l4" href="#install-instructions">Install Instructions</a></li>
        
            <li><a class="toctree-l4" href="#configuring-frontier-squid">Configuring Frontier Squid</a></li>
        
            <li><a class="toctree-l4" href="#starting-and-stopping-the-frontier-squid-service">Starting and Stopping the Frontier Squid Service</a></li>
        
            <li><a class="toctree-l4" href="#testing-frontier-squid">Testing Frontier Squid</a></li>
        
            <li><a class="toctree-l4" href="#getting-help">Getting Help</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../../other/cvmfs/">CVMFS</a>
                </li>
                <li class="">
                    
    <a class="" href="../../other/gsissh/">GSI-enabled SSH</a>
                </li>
                <li class="">
                    
    <a class="" href="../../other/wn/">RPM-based Worker Node</a>
                </li>
                <li class="">
                    
    <a class="" href="../../other/glexec/">Worker node glexec</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Release Information</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../release/release_series/">OSG Release Series</a>
                </li>
                <li class="">
                    
    <a class="" href="../../release/signing/">RPM Signing</a>
                </li>
                <li class="">
                    
    <a class="" href="../../release/supported_platforms/">Supported Platforms</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">In-Progress Docs</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../common/ca_updater/">CA Updater</a>
                </li>
                <li class="">
                    
    <a class="" href="../../common/cert_scripts/">Certificate Request Scripts</a>
                </li>
                <li class="">
                    
    <a class="" href="../../compute-element/job_router/">Job Router Recipe</a>
                </li>
                <li class="">
                    
    <a class="" href="../../other/wn_oasis/">OASIS-based Worker Node</a>
                </li>
                <li class="">
                    
    <a class="" href="../../storage/gridftp/">GridFTP Server</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Deprecated Software</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../Storage/bestman-overview/">BeStMan Overview</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">OSG Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Install Guides &raquo;</li>
        
      
    
    <li>HTTP Cache</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/opensciencegrid/docs/edit/master/docs/frontier-squid/squid.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="frontier-squid-caching-proxy-installation-guide">Frontier Squid Caching Proxy Installation Guide</h1>
<p><span class="twiki-macro TOC" depth="3"></span></p>
<h2 id="about-this-document">About This Document</h2>
<p>This document is intended for System Administrators who are installing
<code>frontier-squid</code>, the OSG distribution of the Frontier Squid software.</p>
<h2 id="applicable-versions">Applicable Versions</h2>
<p>The applicable software versions for this document are OSG Version &gt;=
3.2.16. The version of frontier-squid installed should be &gt;= 2.7.STABLE9-19.1</p>
<h2 id="about-frontier-squid">About Frontier Squid</h2>
<p>Frontier Squid is a distribution of the well-known <a href="http://squid-cache.org">squid HTTP caching
proxy software</a> that is optimized for use with
applications on the Worldwide LHC Computing Grid (WLCG). It has <a href="https://twiki.cern.ch/twiki/bin/view/Frontier/InstallSquid#Why_use_frontier_squid_instead_o">many
advantages</a>
over regular squid for common grid applications, especially Frontier and
CVMFS.</p>
<p>The OSG distribution of frontier-squid is a straight rebuild of the
upstream frontier-squid package for the convenience of OSG users.</p>
<h2 id="frontier-squid-is-recommended">Frontier Squid is Recommended</h2>
<p>OSG recommends that all sites run a caching proxy for HTTP and HTTPS to
help reduce bandwidth and improve throughput. To that end, Compute
Element (CE) installations include Frontier Squid automatically. We
encourage all sites to configure and use this service, as described
below.</p>
<p>For large sites that expect heavy load on the proxy, it may be best to
run the proxy on its own host. In that case, the Frontier Squid software
still will be installed on the CE, but it need not be enabled. Instead,
install your proxy service on the separate host and then configure the
CE host to refer to the proxy on that host.</p>
<p>The <code>osg-configure</code> configuration tool (version 1.0.45 and later) warns
users who have not added the proxy location to their CE configuration.
In the future, a proxy will be required and osg-configure will fail if
the proxy location is not set.</p>
<h2 id="engineering-considerations">Engineering Considerations</h2>
<p>If you will be supporting the Frontier application at your site, review
the <a href="https://twiki.cern.ch/twiki/bin/view/Frontier/InstallSquid#Hardware">upstream documentation Hardware considerations
section</a>
to determine how to size your equipment.</p>
<h2 id="requirements">Requirements</h2>
<h3 id="host-and-os">Host and OS</h3>
<ul>
<li>OS is Red Hat Enterprise Linux 5, 6, 7, and variants</li>
<li>Root access</li>
</ul>
<h3 id="users-the-frontier-squid-installation-will-create-one-user-account">Users The frontier-squid installation will create one user account</h3>
<p>unless it already exists.</p>
<table>
<thead>
<tr>
<th>User</th>
<th>Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>squid</code></td>
<td>Reduced privilege user that the squid process runs under. Set the default gid of the “squid” user to be a group that is also called “squid”.</td>
</tr>
</tbody>
</table>
<p>The package can instead use another user name of your choice if you
create a configuration file before installation. Details are in the
<a href="https://twiki.cern.ch/twiki/bin/view/Frontier/InstallSquid#Preparation">upstream documentation Preparation
section</a>.</p>
<h3 id="networking">Networking</h3>
<table>
<thead>
<tr>
<th>Service Name</th>
<th>Protocol</th>
<th>Port Number</th>
<th>Inbound</th>
<th>Outbound</th>
<th>Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td>Squid</td>
<td>tcp</td>
<td>3128</td>
<td>✓</td>
<td>✓</td>
<td>Also limited in squid ACLs. Both in and outbound must not be wide open to internet simultaneously</td>
</tr>
<tr>
<td>Squid monitor</td>
<td>udp</td>
<td>3401</td>
<td>✓</td>
<td></td>
<td>Also limited in squid ACLs. Should be limited to monitoring server addresses</td>
</tr>
</tbody>
</table>
<p>The addresses of the WLCG monitoring servers for use in firewalls are
listed in the <a href="https://twiki.cern.ch/twiki/bin/view/Frontier/InstallSquid#Enabling_monitoring">upstream documentation Enabling monitoring
section</a>.</p>
<h2 id="install-instructions">Install Instructions</h2>
<p>Prior to installing squid, make sure the host's <code>yum</code> repositories are <a href="../../common/yum/">configured correctly</a> for OSG.</p>
<p>Once configured, install <code>frontier-squid</code>:</p>
<div class="codehilite"><pre><span></span>[root@client ~]$ yum install frontier-squid
</pre></div>


<p>Then enable it to start at boot:</p>
<div class="codehilite"><pre><span></span>[root@client ~]$ chkconfig frontier-squid on
</pre></div>


<h2 id="configuring-frontier-squid">Configuring Frontier Squid</h2>
<h3 id="configuring-the-frontier-squid-service">Configuring the Frontier Squid Service</h3>
<p>To configure the Frontier Squid service itself:</p>
<ol>
<li>Follow the <a href="https://twiki.cern.ch/twiki/bin/view/Frontier/InstallSquid">original Frontier Squid
    documentation</a>,
    in <a href="https://twiki.cern.ch/twiki/bin/view/Frontier/InstallSquid#Configuration">the Configuration
    section</a>\</li>
<li>Enable, start, and test the service (as described below)</li>
<li>Enable WLCG monitoring as described in the <a href="https://twiki.cern.ch/twiki/bin/view/Frontier/InstallSquid#Enabling_monitoring">upstream documentation
    on enabling
    monitoring</a>
    and <a href="https://twiki.cern.ch/twiki/bin/view/LCG/WLCGSquidRegistration#OIM">register the squid in
    OIM</a>.</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>An important difference between the standard Squid
software and the Frontier Squid variant is that Frontier Squid
changes are in <code>/etc/squid/customize.sh</code> instead of
<code>/etc/squid/squid.conf</code>.</p>
</div>
<h3 id="configuring-the-osg-ce">Configuring the OSG CE</h3>
<p>To configure the OSG Compute Element (CE) to know about your Frontier
Squid service:</p>
<ol>
<li>
<p>On your CE host, edit <code>/etc/osg/config.d/01-squid.ini</code></p>
<ul>
<li>Make sure that <code>enabled</code> is set to <code>True</code></li>
<li>Set <code>location</code> to the hostname and port of your Frontier Squid
    service (e.g., <code>my.squid.host.edu:3128</code>)</li>
<li>Leave the other settings at <code>DEFAULT</code> unless you have specific
    reasons to change them</li>
</ul>
</li>
<li>
<p>Run <code>osg-configure</code> to propagate the changes on your CE</p>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You may want to finish other CE configuration tasks before running
<code>osg-configure</code>. Just be sure to run it once before starting CE services.</p>
</div>
<h2 id="starting-and-stopping-the-frontier-squid-service">Starting and Stopping the Frontier Squid Service</h2>
<p>Starting frontier-squid:</p>
<div class="codehilite"><pre><span></span><span class="c"><span style="color:red">UCL_ROOT_PROMPT</span> service frontier-squid start</span>
</pre></div>


<p>Stopping frontier-squid:</p>
<div class="codehilite"><pre><span></span><span class="c"><span style="color:red">UCL_ROOT_PROMPT</span> service frontier-squid stop</span>
</pre></div>


<h2 id="testing-frontier-squid">Testing Frontier Squid</h2>
<p>As any user on another computer, do the following (where
<span style="color:red">yoursquid.your.domain</span> is
the fully qualified domain name of your squid server):</p>
<div class="codehilite"><pre><span></span>[user@client ~]$ export http_proxy=http://yoursquid.your.domain:3128
[user@client ~]$ wget -qdO/dev/null http://frontier.cern.ch 2&gt;&amp;1|grep X-Cache
X-Cache: MISS from yoursquid.your.domain
[user@client ~]$ wget -qdO/dev/null http://frontier.cern.ch 2&gt;&amp;1|grep X-Cache
X-Cache: HIT from yoursquid.your.domain
</pre></div>


<p>If the grep doesn’t print anything, try removing it from the pipeline to
see if errors are obvious. If the second try says <code>MISS</code> again, something
is probably wrong with the squid cache writes.</p>
<p>If your squid will be supporting the Frontier application, it is also
good to do the test in the <a href="https://twiki.cern.ch/twiki/bin/view/Frontier/InstallSquid#Testing_the_installation">upstream documentation Testing the
installation
section</a>.</p>
<h3 id="frontier-squid-log-files">Frontier Squid Log Files</h3>
<p>Log file contents are explained in the <a href="https://twiki.cern.ch/twiki/bin/view/Frontier/InstallSquid#Log_file_contents">upstream documentation Log file
contents section</a>.</p>
<h2 id="getting-help">Getting Help</h2>
<p>To get assistance please use <a href="../HelpProcedure">Help Procedure</a>.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../other/cvmfs/" class="btn btn-neutral float-right" title="CVMFS">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../../compute-element/HTCondor_CE/" class="btn btn-neutral" title="HTCondor-CE"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/opensciencegrid/docs" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../../compute-element/HTCondor_CE/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../other/cvmfs/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../../js/theme.js"></script>

</body>
</html>
